# AI Care Shift Scheduler - 引き継ぎプロンプト

**作成日**: 2025-12-09
**作成者**: Claude Code セッション

---

## 緊急対応: BUG-019 Firestoreインデックス未デプロイ

### エラー内容

```
評価履歴の取得に失敗: FirebaseError: The query requires an index.
```

本番環境（`ai-care-shift-scheduler.web.app`）で`aiGenerationHistory`コレクションのクエリがインデックス不足エラーを発生。

### 原因

`firestore.indexes.json`は修正済み（`COLLECTION` → `COLLECTION_GROUP`）だが、**Firebase Firestoreへのインデックスデプロイが未実行**。

### 解決手順

```bash
# 1. インデックスをデプロイ
firebase deploy --only firestore:indexes

# または GitHub Actions 経由でデプロイ
git push origin main  # CI/CDが自動実行

# 2. インデックス構築完了を待機（数分〜数十分）
# Firebase Console > Firestore > Indexes で確認
```

### 関連ファイル

- `firestore.indexes.json` - インデックス定義（修正済み）
- `.kiro/bugfix-firestore-index-aiGenerationHistory-2025-12-09.md` - BUG-019詳細

---

## プロジェクト概要

**AI Care Shift Scheduler** - 介護施設向けAI自動シフト生成システム

- **フロントエンド**: React + TypeScript + Vite
- **バックエンド**: Firebase (Auth, Firestore, Functions, Hosting)
- **AI**: Gemini 2.5 Flash (Vertex AI)
- **本番URL**: https://ai-care-shift-scheduler.web.app

---

## 重要ドキュメント

### 必読

1. **CLAUDE.md** - プロジェクト全体のルール・制約（最重要）
2. **.kiro/steering/** - プロジェクト固有の設計方針
3. **.kiro/specs/** - 機能仕様書

### 最近の変更

- **Phase 54** (2025-12-09): AI評価履歴・再評価機能 ✅ 完了
- **Phase 53** (2025-12-09): 制約レベル別評価システム ✅ 完了
- **.kiro整理** (2025-12-09): ドキュメント構造改善 ✅ 完了

---

## 開発ワークフロー

```bash
# 1. コード変更
# 2. 型チェック
cd functions && npx tsc --noEmit

# 3. CodeRabbitレビュー
coderabbit review --plain --base-commit HEAD~1 --config CLAUDE.md

# 4. コミット & プッシュ
git add . && git commit -m "..."
git push origin main

# 5. GitHub Actions 監視
gh run list --limit 1
```

---

## Gemini API 重要ルール

CLAUDE.mdの「Gemini 2.5 Flash 設定ルール」セクションを必ず参照。特に：

1. **@google/genai SDK使用必須**（@google-cloud/vertexaiは非対応）
2. **maxOutputTokens: 65536**（思考モード対応）
3. **thinkingBudget: 16384**（思考トークン制限）
4. **responseSchema/responseMimeType禁止**（thinkingBudgetと非互換）

---

## 次のタスク

1. **BUG-019解決**: Firestoreインデックスをデプロイ
2. **Phase 45継続**: AIシフト生成進行状況表示機能（作業中）

---

## Serenaメモリ

関連メモリを`read_memory`で確認：

- `phase54_evaluation_history_reevaluate_2025-12-09`
- `phase53_constraint_level_evaluation_2025-12-09`
- `bug019_firestore_index_2025-12-09`（作成推奨）

---

## 注意事項

- **Firebase CLI認証エラー時**: GitHub Actions経由でデプロイ（CLAUDE.md参照）
- **インデックス変更後**: 構築完了まで数分〜数十分待機が必要
- **デプロイ後**: ハードリロード（Cmd+Shift+R）で確認
