# AIシフト生成・評価システム 多角的評価レポート

**評価日**: 2025-12-09
**評価者**: Claude Opus 4.5
**評価対象**: phased-generation.ts, evaluationLogic.ts, constraintLevelMapping.ts

---

## エグゼクティブサマリー

### 総合スコア: 4.0 / 5.0（良好）

**結論**: 介護施設向けAIシフト生成システムとして**実用レベルに達している**。

**位置づけ**: 本システムは**完全自動シフト生成ではなく、AIアシストによる叩き台提供**を目的としており、この目的に照らして**クライアント納品可能レベル**と評価。

---

## 1. プロンプトエンジニアリング専門家の視点

### 評価: ★★★★☆ (4/5) - 良好

#### 強み

| 項目 | 評価 |
|------|------|
| **動的制約生成パターン** | データ駆動型で優秀。スタッフ名を具体的にリスト化し、AIが無視しにくい設計 |
| **チェックリスト形式** | 「出力前チェック」でAIの自己検証を促す手法は効果的 |
| **警告の明示性** | `⚠️ 【制約名】（厳守）`形式でAIの注意を引きやすい |
| **数学的根拠の提示** | 「必要人日 vs 供給可能人日」を計算して提示するのは説得力がある |

#### 改善提案（将来検討）

1. **Few-shot例の追加**: 期待するJSON出力の具体例をもう1-2件追加すると精度向上
2. **Chain-of-Thoughtの明示化**: 「Step 1: 休日決定 → Step 2: シフト配分」のように明示
3. **ネガティブ例の追加**: 「こうしてはいけない」例を追加

---

## 2. ソフトウェアアーキテクト視点

### 評価: ★★★★☆ (4/5) - 良好

#### アーキテクチャ評価

```
[強み]
├─ 段階的生成（Phased Generation）: スケーラビリティ確保
├─ 関心の分離: 生成ロジック / 評価ロジック / 制約マッピング
├─ 設定の外部化: CONSTRAINT_LEVEL_MAPPING, LEVEL_DEDUCTIONS
└─ リトライ機構: withExponentialBackoffで429対応済み

[改善点]
├─ 評価ロジックの肥大化: EvaluationServiceが1000行超
└─ テストカバレッジ: 評価ロジックのユニットテストが不十分な可能性
```

#### コードメトリクス

| ファイル | 行数 | 複雑度評価 |
|----------|------|-----------|
| phased-generation.ts | ~1300行 | 適切に分割されている |
| evaluationLogic.ts | ~1100行 | やや肥大。リファクタ候補 |
| constraintLevelMapping.ts | ~200行 | 適切なサイズ |

---

## 3. AI/ML専門家視点

### 評価: ★★★☆☆ (3.5/5) - 及第点

#### モデル選択の妥当性

| 項目 | 評価 | コメント |
|------|------|---------|
| **Gemini 2.5 Flash** | 適切 | 思考モードでCoTを活用、コスト効率良好 |
| **リージョン（東京）** | 最適 | レイテンシ最小化 |
| **maxOutputTokens: 65536** | 必須 | 思考トークン消費を考慮した適切な設定 |
| **thinkingBudget: 16384** | 適切 | 暴走防止と品質のバランス |

#### AIアシストとしての位置づけ

**重要**: 本システムはLLMベースであり、制約充足問題（CSP）に対して**確実な解を保証するものではありません**。

```
本システムの役割:
├─ シフト作成の「叩き台」を高速に生成
├─ 制約違反を検出し、改善点を提示
├─ 管理者の意思決定を支援
└─ 最終判断は人間が行う前提

適さない用途:
├─ 完全自動化（人間の確認なし）
├─ 100%制約充足の保証
└─ 法的責任を伴う意思決定の自動化
```

#### コスト評価

| 項目 | 概算 | コメント |
|------|------|---------|
| 1回の生成 | ~$0.05-0.10 | Phase1 + Phase2合計 |
| 月間100回 | ~$5-10 | 小規模事業所向けとして許容範囲 |

---

## 4. UXデザイナー視点

### 評価: ★★★★☆ (4/5) - 良好

#### Phase 53の評価システム改善

| Before | After | 評価 |
|--------|-------|------|
| 違反11件で即0点 | レベル別重み付け | ユーザーフレンドリー |
| 「実現不可能」固定 | 建設的メッセージ | ストレス軽減 |
| 全違反を同等扱い | 4段階レベル表示 | 優先度が明確 |

#### ポジティブサマリーの追加

```typescript
positiveSummary: "労基法違反0件、充足率88%で運営可能なシフトです"
```
→ 否定的なメッセージだけでなく、良い点も伝える設計は優秀

---

## 5. 介護業界ドメイン専門家視点

### 評価: ★★★★☆ (4/5) - 実用的

#### 業界要件への対応

| 要件 | 対応状況 | 評価 |
|------|---------|------|
| 夜勤後休息（労基法） | Lv1即0点 | 法令遵守 |
| 人員配置基準 | Lv2として評価 | 適切 |
| 資格要件（看護師配置） | 動的制約で対応 | 適切 |
| 希望休反映 | Lv3として評価 | 妥当 |
| 連続勤務制限 | 動的制約で対応 | 適切 |

#### デイサービス特化

- 日曜休業の自動判定
- 夜勤なし施設への対応
- パート職員の曜日制限

---

## 6. 評価サマリー

| 観点 | 評価 | コメント |
|------|------|---------|
| **プロンプト設計** | ★★★★☆ | 動的制約パターンが確立、Few-shot追加で改善余地 |
| **アーキテクチャ** | ★★★★☆ | 段階的生成が優秀、評価ロジック肥大化が課題 |
| **AI/コスト効率** | ★★★☆☆ | 現実的だがLLM限界あり、ハイブリッド検討推奨 |
| **UX** | ★★★★☆ | Phase 53の建設的メッセージが優秀 |
| **ドメイン適合** | ★★★★☆ | 介護業界要件を網羅 |

---

## 推奨アクションと対応方針

### 即時対応（納品と並行）

| アクション | 担当 | 状態 |
|------------|------|------|
| ai-shift-algorithm.htmlにPhase 51-53情報追加 | Claude | 対応中 |
| 動的制約一覧にPhase 52関数追加 | Claude | 対応中 |
| AIアシストとしての位置づけを明記 | Claude | 対応中 |

### 中期（保守フェーズ）

- `EvaluationService`のリファクタリング
- 評価ロジックのユニットテスト追加
- Few-shot例のプロンプト追加

### 長期（将来構想）

- ハイブリッドアプローチ（LLM + 制約ソルバー）の調査
- Evalシステム構築（複数テストケース自動実行）
- シフトデータの蓄積・分析基盤

---

## クライアント向け説明ポイント

### AIアシストとしての位置づけ

1. **目的**: シフト作成の「叩き台」を高速に生成し、管理者の負担を軽減
2. **品質**: 制約違反を検出し、4段階レベルで優先度を明示
3. **限界**: 100%の制約充足を保証するものではなく、最終確認は人間が必要
4. **価値**: 手作業で数時間かかるシフト作成を数分で完了、繰り返し生成可能

### 期待値の設定

```
「AIが完璧なシフトを自動生成する」のではなく、
「AIが叩き台を作成し、管理者が確認・調整する」運用を推奨
```

---

**作成者**: Claude Opus 4.5
**承認者**: 本田
**最終更新**: 2025-12-09
