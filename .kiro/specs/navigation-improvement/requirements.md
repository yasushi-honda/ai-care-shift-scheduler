# Phase 42.1: ナビゲーション改善 - 要件定義

**作成日**: 2025-12-06
**ステータス**: 承認済み
**優先度**: 高

---

## 1. 概要

### 1.1 背景
ユーザビリティ調査により、以下の問題が発見された：

1. **レポートページ（/reports）からメイン画面への戻り導線がない**
   - ユーザーがレポートページに移動後、シフト管理画面に戻る手段がない
   - ブラウザの戻るボタン以外に方法がない

2. **ログアウトボタンに確認機能がない**
   - 誤操作でログアウトするリスクがある
   - 作業中のデータ損失の可能性

### 1.2 目的
- ユーザーの迷子防止
- 誤操作によるログアウト防止
- 一貫したナビゲーション体験の提供

### 1.3 スコープ

| 対象 | 含む | 含まない |
|------|------|----------|
| レポートページナビゲーション | ✅ | |
| ログアウト確認ダイアログ | ✅ | |
| 管理画面ナビゲーション | | ❌（別Phase） |
| グローバルヘッダー統一 | | ❌（別Phase） |

---

## 2. 機能要件

### FR-1: レポートページへの戻るナビゲーション追加

**要件ID**: FR-1
**優先度**: 高

| 項目 | 要件 |
|------|------|
| 表示位置 | ヘッダー左上、タイトル「月次レポート」の左側 |
| コンポーネント | 戻るボタン（← アイコン + テキスト） |
| 遷移先 | メインページ（シフト管理画面: `/`） |
| アクセシビリティ | aria-label設定、キーボード操作対応 |

**UI仕様**:
```
┌─────────────────────────────────────────────────────┐
│ ← シフト管理     月次レポート      [月ナビゲーター] │
└─────────────────────────────────────────────────────┘
```

### FR-2: ログアウト確認ダイアログ追加

**要件ID**: FR-2
**優先度**: 高

| 項目 | 要件 |
|------|------|
| トリガー | ログアウトボタンクリック時 |
| 確認方法 | 確認ダイアログ（window.confirm） |
| メッセージ | 「ログアウトしますか？」 |
| 選択肢 | OK（ログアウト実行） / キャンセル（何もしない） |

**フロー**:
```
ログアウトボタン → 確認ダイアログ表示 → OK → ログアウト処理
                                      → キャンセル → 何もしない
```

---

## 3. 非機能要件

### NFR-1: アクセシビリティ

| 項目 | 基準 |
|------|------|
| キーボード操作 | 戻るボタンはTab/Enterで操作可能 |
| スクリーンリーダー | aria-label対応 |
| フォーカス | 明確なフォーカスリング表示 |

### NFR-2: パフォーマンス

| 項目 | 基準 |
|------|------|
| ダイアログ表示速度 | 即時（window.confirm使用） |
| 遷移速度 | 既存と同等 |

### NFR-3: 一貫性

| 項目 | 基準 |
|------|------|
| デザイン | Phase 42のデザイントークンに準拠 |
| アイコン | Heroicons使用 |

---

## 4. 受け入れ条件

### AC-1: レポートページナビゲーション
- [ ] レポートページヘッダーに戻るボタンが表示される
- [ ] 戻るボタンクリックでシフト管理画面（/）に遷移する
- [ ] モバイル・デスクトップ両方で正しく表示される
- [ ] キーボード操作（Tab + Enter）で動作する

### AC-2: ログアウト確認
- [ ] ログアウトボタンクリック時に確認ダイアログが表示される
- [ ] 「OK」選択時にログアウト処理が実行される
- [ ] 「キャンセル」選択時に何も起こらない
- [ ] 管理画面のログアウトボタンにも同様の確認が適用される

---

## 5. 影響範囲

### 変更対象ファイル
| ファイル | 変更内容 |
|----------|----------|
| `src/pages/reports/ReportPage.tsx` | 戻るボタン追加 |
| `App.tsx` | handleSignOutに確認ダイアログ追加 |
| `src/pages/admin/AdminLayout.tsx` | handleSignOutに確認ダイアログ追加（必要に応じて） |

### リスク
| リスク | 影響 | 軽減策 |
|--------|------|--------|
| 既存E2Eテストへの影響 | 低 | セレクタ変更なし |
| ユーザー混乱 | 低 | 機能追加のみ、削除なし |

---

## 6. 関連ドキュメント

- [Phase 42 UIデザイン改善 要件](../ui-design-improvement/requirements.md)
- [Phase 42 UIデザイン改善 設計](../ui-design-improvement/design.md)
