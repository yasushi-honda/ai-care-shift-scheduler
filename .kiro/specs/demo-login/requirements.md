# Phase 42.2: デモログイン機能 - 要件定義

**作成日**: 2025-12-06
**ステータス**: 承認済み
**優先度**: 高

---

## 1. 概要

### 1.1 背景
クライアント（見込み顧客）にアプリケーションを試用してもらうため、簡単にデモ環境にアクセスできる機能が必要。現在はGoogleアカウントでのログインのみ対応しており、新規ユーザーは権限付与の手続きが必要。

### 1.2 目的
- クライアントがワンクリックでデモ環境にアクセス可能にする
- 既存のデモデータ（サンプル介護施設）を使って機能を体験できるようにする
- 営業・デモ活動の効率化

### 1.3 スコープ

| 対象 | 含む | 含まない |
|------|------|----------|
| デモログインボタン追加 | ✅ | |
| デモアカウント認証 | ✅ | |
| viewer権限での閲覧 | ✅ | |
| 別デモ環境 | | ❌（本番環境を使用） |

---

## 2. 機能要件

### FR-1: デモログインボタン

**要件ID**: FR-1
**優先度**: 高

| 項目 | 要件 |
|------|------|
| 表示位置 | ログインページ、Googleログインボタンの下 |
| ボタンラベル | 「デモアカウントでログイン」 |
| 視覚的区別 | Googleボタンと異なるスタイル（セカンダリボタン） |
| 説明文 | 「サンプルデータで機能をお試しいただけます」 |

**UI仕様**:
```
┌─────────────────────────────────────────┐
│         シフト作成ツール                 │
│    介護施設向けシフト管理システム         │
│                                          │
│  ┌───────────────────────────────────┐  │
│  │ [G] Googleでログイン              │  │
│  └───────────────────────────────────┘  │
│                                          │
│  ────────── または ──────────            │
│                                          │
│  ┌───────────────────────────────────┐  │
│  │ デモアカウントでログイン           │  │
│  └───────────────────────────────────┘  │
│  サンプルデータで機能をお試しいただけます │
│                                          │
└─────────────────────────────────────────┘
```

### FR-2: デモアカウント認証

**要件ID**: FR-2
**優先度**: 高

| 項目 | 要件 |
|------|------|
| 認証方式 | Firebase Email/Password認証 |
| デモアカウント | demo@example.com（固定） |
| パスワード | 環境変数または固定値（内部管理） |
| アクセス権限 | demo-facility-001へのviewer権限 |

### FR-3: デモ用データアクセス

**要件ID**: FR-3
**優先度**: 高

| 項目 | 要件 |
|------|------|
| 対象施設 | demo-facility-001（サンプル介護施設） |
| データ内容 | 既存デモデータ（10名スタッフ、シフト要件、休暇申請） |
| 権限レベル | viewer（閲覧のみ） |

---

## 3. 非機能要件

### NFR-1: セキュリティ

| 項目 | 基準 |
|------|------|
| パスワード露出 | クライアントサイドコードに直接埋め込まない |
| 権限制限 | viewer権限のみ（データ変更不可） |
| セッション | 通常のFirebase Auth セッション管理 |

### NFR-2: パフォーマンス

| 項目 | 基準 |
|------|------|
| ログイン速度 | Google認証と同等 |
| 追加依存なし | 既存のFirebase Auth機能を使用 |

### NFR-3: ユーザー体験

| 項目 | 基準 |
|------|------|
| ワンクリック | ボタン1回のクリックでログイン完了 |
| エラーハンドリング | 失敗時は明確なメッセージ表示 |

---

## 4. 受け入れ条件

### AC-1: デモログインボタン
- [ ] ログインページに「デモアカウントでログイン」ボタンが表示される
- [ ] ボタンクリックでデモアカウントとしてログインできる
- [ ] ログイン後、サンプル介護施設のデータが閲覧できる

### AC-2: 既存機能との整合性
- [ ] Googleログインボタンは引き続き動作する
- [ ] デモログイン後もログアウトが正常に動作する
- [ ] 型チェック・ビルドが通る

---

## 5. 技術設計

### 5.1 実装アプローチ（セキュア版）

**セキュリティ考慮**: クライアントサイドでの認証情報ハードコードを避け、Cloud Functionでカスタムトークンを発行する方式を採用。

1. **Cloud Function (demoSignIn)**
   - サーバーサイドでデモユーザーを作成/管理
   - カスタムトークンを発行してクライアントに返す
   - 認証情報はサーバーサイドでのみ保持

2. **AuthContextの拡張**
   - `signInWithDemo()` 関数を追加
   - Cloud Functionを呼び出してカスタムトークンを取得
   - `signInWithCustomToken`でサインイン

3. **LoginPageの更新**
   - デモログインボタンを追加
   - クリック時に`signInWithDemo()`を呼び出し

### 5.2 変更ファイル一覧

| ファイル | 種別 | 変更内容 |
|----------|------|----------|
| `functions/src/demoSignIn.ts` | 新規 | Cloud Function: カスタムトークン発行 |
| `functions/src/index.ts` | 変更 | demoSignInエクスポート追加 |
| `src/contexts/AuthContext.tsx` | 変更 | signInWithDemo追加（Cloud Function呼び出し） |
| `src/components/LoginPage.tsx` | 変更 | デモログインボタン追加 |

---

## 6. リスク

| リスク | 影響 | 軽減策 |
|--------|------|--------|
| デモアカウント悪用 | 中 | viewer権限に制限 |
| デモデータ改変 | 低 | 権限でブロック |
| ~~パスワード漏洩~~ | ~~中~~ | ~~Cloud Function方式で解決済み~~ |

---

## 7. 関連ドキュメント

- [Phase 42.1 ナビゲーション改善](.kiro/specs/navigation-improvement/requirements.md)
- [デモデータテストガイド](../../docs/demo-data-testing-guide.md)
