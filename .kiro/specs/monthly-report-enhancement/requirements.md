# Requirements Document

## はじめに

本ドキュメントは、Phase 41「レポート機能強化」の要件を定義する。AIシフト自動作成システムにおいて、月次レポート生成、シフト集計機能、PDF出力機能を実装し、管理者とスタッフの業務効率化を実現する。

### ビジネス価値
- **経営判断支援**: シフトデータの可視化により、人員配置の最適化を支援
- **業務効率化**: 手動集計作業の削減（推定80%の時間短縮）
- **コンプライアンス**: 労働時間の正確な把握と法令遵守の確認
- **スタッフ満足度向上**: 透明性の高い勤務実績の共有

---

## 要件

### 要件1: 月次レポートダッシュボード

**目的**: 管理者として、月次のシフト・勤務データを一覧で確認したい。経営判断と人員配置の最適化に活用するため。

#### 受入基準

1. WHEN 管理者がレポートページにアクセスする THEN レポートサービスは当月のサマリーダッシュボードを表示する SHALL
2. WHEN 管理者が対象月を選択する THEN レポートサービスは選択された月のデータを集計して表示する SHALL
3. WHERE ダッシュボード画面 THE レポートサービスは以下のサマリー指標を表示する SHALL:
   - 総勤務時間（全スタッフ合計）
   - シフト種別ごとの割合（早番・日勤・遅番・夜勤・休み）
   - 人員充足率（必要人数に対する実績）
   - 有給消化率
4. WHILE データが読み込み中 THE レポートサービスはローディングインジケーターを表示する SHALL

---

### 要件2: 勤務時間集計機能

**目的**: 管理者として、スタッフごとの勤務時間を正確に把握したい。労働基準法遵守と給与計算の基礎データとするため。

#### 受入基準

1. WHEN 管理者が勤務時間レポートを開く THEN レポートサービスはスタッフ別の月間勤務時間一覧を表示する SHALL
2. WHERE 勤務時間レポート THE レポートサービスは以下の情報を表示する SHALL:
   - スタッフ名
   - 総勤務時間
   - 通常勤務時間
   - 夜勤時間
   - 推定残業時間
3. IF スタッフの月間勤務時間が160時間を超える THEN レポートサービスは警告アイコンを表示する SHALL
4. WHEN 管理者がスタッフ行をクリックする THEN レポートサービスは日別の勤務詳細を展開表示する SHALL

---

### 要件3: シフト種別集計機能

**目的**: 管理者として、シフト種別ごとの配置状況を把握したい。人員配置の偏りを把握し改善するため。

#### 受入基準

1. WHEN 管理者がシフト種別レポートを開く THEN レポートサービスは種別ごとの集計データを表示する SHALL
2. WHERE シフト種別レポート THE レポートサービスは以下を円グラフで表示する SHALL:
   - 早番の総回数と割合
   - 日勤の総回数と割合
   - 遅番の総回数と割合
   - 夜勤の総回数と割合
   - 休日の総回数と割合
3. WHERE シフト種別レポート THE レポートサービスはスタッフ別のシフト種別内訳を棒グラフで表示する SHALL
4. IF 特定のスタッフに夜勤が月8回以上集中している THEN レポートサービスは負荷偏り警告を表示する SHALL

---

### 要件4: スタッフ別稼働統計

**目的**: 管理者として、各スタッフの稼働状況を詳細に分析したい。公平な勤務配分と個別のフォローアップのため。

#### 受入基準

1. WHEN 管理者がスタッフ稼働レポートを開く THEN レポートサービスは全スタッフの稼働統計一覧を表示する SHALL
2. WHERE スタッフ稼働レポート THE レポートサービスは以下の指標を表示する SHALL:
   - 出勤日数
   - 休日数（公休・有給・その他）
   - 連続勤務最大日数
   - 平均週間勤務時間
3. WHEN 管理者が特定スタッフを選択する THEN レポートサービスは個人詳細ページを表示する SHALL
4. WHERE 個人詳細ページ THE レポートサービスは月間カレンダービューとトレンドグラフを表示する SHALL

---

### 要件5: 管理者向け経営分析レポート

**目的**: 管理者・施設長として、経営判断に必要な分析レポートを取得したい。人件費最適化と人員計画策定のため。

#### 受入基準

1. WHEN 管理者が経営分析レポートを生成する THEN レポートサービスは以下のセクションを含むレポートを作成する SHALL:
   - 人員配置サマリー
   - 時間帯別人員充足率
   - 資格別配置状況
   - コスト推計（推定人件費）
2. WHERE 経営分析レポート THE レポートサービスは前月比較データを表示する SHALL
3. IF 人員充足率が80%未満の日がある THEN レポートサービスは改善提案を表示する SHALL
4. WHEN 管理者がレポートをエクスポートする THEN レポートサービスはPDF形式でダウンロード可能にする SHALL

---

### 要件6: スタッフ向け勤務実績レポート

**目的**: スタッフとして、自分の勤務実績を確認したい。勤務状況の把握と給与明細との照合のため。

#### 受入基準

1. WHEN スタッフが自身のレポートを開く THEN レポートサービスは本人の勤務実績のみを表示する SHALL
2. WHERE スタッフレポート THE レポートサービスは以下を表示する SHALL:
   - 月間出勤日数
   - 総勤務時間
   - シフト種別内訳
   - 有給残日数
3. WHILE スタッフがレポートを閲覧中 THE レポートサービスは他スタッフのデータを表示しない SHALL
4. WHEN スタッフが自身のレポートをダウンロードする THEN レポートサービスはPDF形式で個人レポートを生成する SHALL

---

### 要件7: PDF出力機能

**目的**: 管理者・スタッフとして、レポートをPDFでダウンロードしたい。印刷・共有・記録保存のため。

#### 受入基準

1. WHEN ユーザーがPDFダウンロードボタンをクリックする THEN レポートサービスはPDFファイルを生成してダウンロードを開始する SHALL
2. WHERE PDF出力 THE レポートサービスは以下の形式要件を満たす SHALL:
   - A4縦向きフォーマット
   - ヘッダー：施設名、レポート種別、対象期間
   - フッター：生成日時、ページ番号
   - 日本語フォント対応
3. IF PDFにグラフが含まれる THEN レポートサービスはグラフをSVG形式で高品質に出力する SHALL
4. WHILE PDF生成中 THE レポートサービスは進捗インジケーターを表示する SHALL
5. IF PDF生成に失敗した THEN レポートサービスはエラーメッセージと再試行ボタンを表示する SHALL

---

### 要件8: レスポンシブ対応

**目的**: ユーザーとして、PC・タブレット・スマートフォンでレポートを確認したい。場所を選ばず情報にアクセスするため。

#### 受入基準

1. WHERE デスクトップ（幅1024px以上）THE レポートサービスはフルレイアウトで表示する SHALL
2. WHERE タブレット（幅768px-1023px）THE レポートサービスはサイドバーを折りたたみ可能にする SHALL
3. WHERE モバイル（幅767px以下）THE レポートサービスはカード形式のシンプルレイアウトで表示する SHALL
4. WHEN ユーザーがモバイルでPDFダウンロードする THEN レポートサービスはモバイル対応のダウンロードフローを提供する SHALL

---

### 要件9: データ更新とキャッシュ

**目的**: 管理者として、最新のデータでレポートを確認したい。リアルタイムな状況把握のため。

#### 受入基準

1. WHEN レポートページを開く THEN レポートサービスは最新のFirestoreデータを取得する SHALL
2. IF 同一月のレポートが過去5分以内に取得済み THEN レポートサービスはキャッシュデータを使用する SHALL
3. WHEN ユーザーが更新ボタンをクリックする THEN レポートサービスはキャッシュを無効化して最新データを取得する SHALL
4. WHILE データ更新中 THE レポートサービスは更新インジケーターを表示する SHALL

---

## 非機能要件

### パフォーマンス
- レポート初期表示: 3秒以内
- PDF生成: 10秒以内
- データ集計: 5秒以内（1000件のシフトデータ）

### セキュリティ
- 認証済みユーザーのみアクセス可能
- スタッフは自身のデータのみ閲覧可能
- 管理者は全スタッフのデータを閲覧可能

### 互換性
- Chrome, Firefox, Safari, Edgeの最新2バージョン
- iOS Safari, Android Chromeの最新バージョン

---

## 用語集

| 用語 | 説明 |
|------|------|
| 月次レポート | 1ヶ月単位で集計されたシフト・勤務データのレポート |
| 人員充足率 | 必要人数に対する実際の配置人数の割合 |
| 経営分析レポート | 管理者向けの詳細な分析データを含むレポート |
| 勤務実績レポート | スタッフ個人向けの勤務データレポート |
