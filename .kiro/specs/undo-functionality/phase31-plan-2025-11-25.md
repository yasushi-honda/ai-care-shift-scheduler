# Phase 31: ã‚¢ãƒ³ãƒ‰ã‚¥æ©Ÿèƒ½ï¼ˆã‚·ãƒ•ãƒˆå¤‰æ›´å–ã‚Šæ¶ˆã—ï¼‰

**ä½œæˆæ—¥**: 2025-11-25
**ä»•æ§˜ID**: undo-functionality
**Phase**: 31
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”„ å®Ÿè£…ä¸­

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

ã‚·ãƒ•ãƒˆå¤‰æ›´å¾Œã«ã€Œå…ƒã«æˆ»ã™ã€ãƒœã‚¿ãƒ³ã§ç›´å‰ã®å¤‰æ›´ã‚’å–ã‚Šæ¶ˆã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚èª¤æ“ä½œæ™‚ã®å¾©å…ƒã‚’å¯èƒ½ã«ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

### ç›®æ¨™

- [ ] ç›´å‰ã®ã‚·ãƒ•ãƒˆå¤‰æ›´ã‚’å–ã‚Šæ¶ˆã›ã‚‹
- [ ] ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã«ã€Œå…ƒã«æˆ»ã™ã€ãƒœã‚¿ãƒ³è¡¨ç¤º
- [ ] Ctrl+Z/Cmd+Zã§ã‚‚ã‚¢ãƒ³ãƒ‰ã‚¥å¯èƒ½
- [ ] è¤‡æ•°å›ã®ã‚¢ãƒ³ãƒ‰ã‚¥å¯¾å¿œï¼ˆå±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ï¼‰

---

## æŠ€è¡“è¨­è¨ˆ

### 1. ã‚¢ãƒ³ãƒ‰ã‚¥å±¥æ­´ã®ç®¡ç†

**çŠ¶æ…‹ç®¡ç†:**
```typescript
interface ShiftHistoryEntry {
  staffId: string;
  date: string;
  type: 'planned' | 'actual';
  previousValue: Partial<GeneratedShift>;
  newValue: Partial<GeneratedShift>;
  timestamp: number;
}

// useStateã§å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã‚’ç®¡ç†
const [undoStack, setUndoStack] = useState<ShiftHistoryEntry[]>([]);
```

### 2. ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ + å…ƒã«æˆ»ã™ãƒœã‚¿ãƒ³

**UIè¨­è¨ˆ:**
```tsx
<Toast>
  <span>ã‚·ãƒ•ãƒˆã‚’å¤‰æ›´ã—ã¾ã—ãŸ</span>
  <button onClick={handleUndo}>å…ƒã«æˆ»ã™</button>
</Toast>
```

### 3. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

**å¯¾å¿œã‚­ãƒ¼:**
| ã‚­ãƒ¼ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|------|-----------|
| Ctrl+Z (Win) | ã‚¢ãƒ³ãƒ‰ã‚¥ |
| Cmd+Z (Mac) | ã‚¢ãƒ³ãƒ‰ã‚¥ |

**å®Ÿè£…:**
```typescript
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
      e.preventDefault();
      handleUndo();
    }
  };
  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, [handleUndo]);
```

---

## WBSï¼ˆä½œæ¥­åˆ†è§£å›³ï¼‰

```mermaid
graph TD
    A[Phase 31: ã‚¢ãƒ³ãƒ‰ã‚¥æ©Ÿèƒ½] --> B[31.1 è¨ˆç”»ãƒ»è¨­è¨ˆ]
    A --> C[31.2 å±¥æ­´ç®¡ç†å®Ÿè£…]
    A --> D[31.3 UIå®Ÿè£…]
    A --> E[31.4 ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ]
    A --> F[31.5 E2Eãƒ†ã‚¹ãƒˆ]
    A --> G[31.6 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™]

    B --> B1[ç¾çŠ¶åˆ†æ]
    B --> B2[æŠ€è¡“è¨­è¨ˆ]

    C --> C1[å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯å®Ÿè£…]
    C --> C2[ã‚¢ãƒ³ãƒ‰ã‚¥é–¢æ•°å®Ÿè£…]

    D --> D1[ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥]
    D --> D2[å…ƒã«æˆ»ã™ãƒœã‚¿ãƒ³]

    E --> E1[Ctrl/Cmd+Zå¯¾å¿œ]

    F --> F1[ã‚¢ãƒ³ãƒ‰ã‚¥ãƒ†ã‚¹ãƒˆè¿½åŠ ]

    G --> G1[å®Œäº†è¨˜éŒ²]
```

---

## ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ

```mermaid
gantt
    title Phase 31 å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    dateFormat HH:mm
    axisFormat %H:%M

    section è¨ˆç”»ãƒ»è¨­è¨ˆ
    ç¾çŠ¶åˆ†æ           :done, a1, 00:00, 10m
    æŠ€è¡“è¨­è¨ˆ           :done, a2, after a1, 10m

    section å±¥æ­´ç®¡ç†
    å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯å®Ÿè£…   :b1, after a2, 15m
    ã‚¢ãƒ³ãƒ‰ã‚¥é–¢æ•°å®Ÿè£…   :b2, after b1, 10m

    section UIå®Ÿè£…
    ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥       :c1, after b2, 15m
    å…ƒã«æˆ»ã™ãƒœã‚¿ãƒ³     :c2, after c1, 10m

    section ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
    Ctrl/Cmd+Zå¯¾å¿œ     :d1, after c2, 10m

    section E2Eãƒ†ã‚¹ãƒˆ
    ã‚¢ãƒ³ãƒ‰ã‚¥ãƒ†ã‚¹ãƒˆ     :e1, after d1, 15m

    section å®Œäº†å‡¦ç†
    ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™   :f1, after e1, 15m
    Git push           :f2, after f1, 5m
```

---

## æˆåŠŸåŸºæº–

- [ ] ç›´å‰ã®ã‚·ãƒ•ãƒˆå¤‰æ›´ã‚’å–ã‚Šæ¶ˆã›ã‚‹
- [ ] ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã«ã€Œå…ƒã«æˆ»ã™ã€ãƒœã‚¿ãƒ³è¡¨ç¤º
- [ ] Ctrl+Z/Cmd+Zã§ã‚¢ãƒ³ãƒ‰ã‚¥å‹•ä½œ
- [ ] TypeScriptã‚¨ãƒ©ãƒ¼ãªã—
- [ ] E2Eãƒ†ã‚¹ãƒˆé€šé

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Phase 30å®Œäº†è¨˜éŒ²](../keyboard-accessibility/phase30-completion-2025-11-25.md)
- [ShiftTable.tsx](../../../components/ShiftTable.tsx)
