# AIシフト自動作成システム 操作マニュアル

**作成日**: 2025年11月12日
**バージョン**: 1.0
**対象**: 介護・福祉事業所の管理者・スタッフ
**本番環境**: https://ai-care-shift-scheduler.web.app

---

## 📖 目次

1. [はじめに](#1-はじめに)
2. [ログイン方法](#2-ログイン方法)
3. [基本操作](#3-基本操作)
   - [スタッフ管理](#31-スタッフ管理)
   - [シフト作成](#32-シフト作成)
   - [休暇申請管理](#33-休暇申請管理)
   - [シフト要件設定](#34-シフト要件設定)
   - [バージョン管理](#35-バージョン管理)
   - [エクスポート機能](#36-エクスポート機能)
4. [ロール別機能](#4-ロール別機能)
5. [管理画面（super-admin専用）](#5-管理画面super-admin専用)
6. [よくある質問](#6-よくある質問)
7. [トラブルシューティング](#7-トラブルシューティング)

---

## 1. はじめに

### 1.1 AIシフト自動作成システムとは？

AIシフト自動作成システムは、介護・福祉事業所のシフト作成業務を効率化するWebアプリケーションです。Google の最新AI「Gemini」を活用し、スタッフの資格・希望・労働基準法を考慮した最適なシフトを自動生成します。

### 1.2 主な機能

- ✅ **Google OAuth認証**: Googleアカウントでログイン（パスワード管理不要）
- ✅ **スタッフ管理**: スタッフ情報の登録・編集・削除
- ✅ **AIシフト自動生成**: 制約条件を考慮した最適シフトを自動作成
- ✅ **休暇申請管理**: カレンダー形式で休暇希望を簡単登録
- ✅ **バージョン管理**: シフトの履歴管理と過去バージョンへの復元
- ✅ **権限管理**: ロールベースのアクセス制御（super-admin/admin/editor/viewer）
- ✅ **CSVエクスポート**: 既存システムへの連携

### 1.3 推奨環境

- **ブラウザ**: Google Chrome（最新版）、Microsoft Edge（最新版）、Safari（最新版）
- **インターネット接続**: 必須
- **Googleアカウント**: 必須

---

## 2. ログイン方法

### 2.1 初回ログイン

1. **本番環境にアクセス**
   - ブラウザで https://ai-care-shift-scheduler.web.app を開く

2. **Googleでログイン**
   - 「Googleでログイン」ボタンをクリック
   - Googleアカウント選択画面が表示されます
   - ログインするGoogleアカウントを選択

3. **権限許可**
   - 「このアプリがGoogleアカウントへのアクセスをリクエストしています」と表示されます
   - 「許可」をクリック

4. **ログイン完了**
   - **初回ユーザーの場合**: 自動的にsuper-admin権限が付与され、メイン画面が表示されます
   - **2人目以降のユーザーの場合**: 「アクセス権限がありません。管理者に連絡してください」画面が表示されます

### 2.2 2回目以降のログイン

1. https://ai-care-shift-scheduler.web.app にアクセス
2. 前回のセッションが有効な場合、自動的にログイン状態で表示されます
3. セッションが切れている場合は、再度「Googleでログイン」をクリック

### 2.3 ログアウト

1. 画面右上のユーザー名またはプロフィール画像をクリック
2. ドロップダウンメニューから「ログアウト」を選択
3. ログイン画面にリダイレクトされます

---

## 3. 基本操作

### 3.1 スタッフ管理

#### 3.1.1 スタッフの追加

1. **「スタッフ追加」ボタンをクリック**
   - メイン画面の上部にある緑色の「スタッフ追加」ボタンをクリック

2. **スタッフ情報を入力**
   - **名前**: スタッフの氏名を入力（例：田中太郎）
   - **役職**: 役職を選択（例：管理者、看護師、介護士、調理員、事務員）
   - **資格**: 保有資格を選択（複数選択可）
     - 介護福祉士
     - 看護師
     - 准看護師
     - 介護職員初任者研修（旧ヘルパー2級）
     - 実務者研修
     - ケアマネージャー
     - 無資格

3. **勤務条件を設定**
   - **週の勤務回数**:
     - 希望: スタッフが希望する週の勤務回数（例：4回）
     - 必須最低: 最低限必要な週の勤務回数（例：3回）
   - **連続勤務の上限**: 連続して勤務できる最大日数（例：5日）
   - **勤務可能曜日**: チェックボックスで選択
   - **時間帯希望**: 希望する勤務時間帯を選択
     - 特になし
     - 日勤のみ
     - 夜勤のみ
     - 早番のみ
     - 遅番のみ
   - **夜勤専従**: 夜勤のみ担当する場合はチェック

4. **「保存」ボタンをクリック**
   - スタッフリストに新しいスタッフが追加されます

#### 3.1.2 スタッフの編集

1. スタッフリストから編集したいスタッフの「編集」ボタンをクリック
2. 情報を修正
3. 「保存」ボタンをクリック

#### 3.1.3 スタッフの削除

1. スタッフリストから削除したいスタッフの「削除」ボタンをクリック
2. 確認ダイアログで「削除」を選択
3. スタッフがリストから削除されます

**注意**: 削除したスタッフは復元できません。慎重に操作してください。

---

### 3.2 シフト作成

#### 3.2.1 シフト要件の確認

シフト生成前に、以下の情報が設定されていることを確認してください：
- ✅ スタッフ情報が登録されている
- ✅ シフト要件（時間帯別必要人員）が設定されている
- ✅ 休暇申請が登録されている（該当する場合）

#### 3.2.2 AIシフト自動生成

1. **対象月を選択**
   - 画面上部の月ナビゲーター（◀ 2025年11月 ▶）で対象月を選択

2. **「AIでシフト作成」ボタンをクリック**
   - 青色の「AIでシフト作成」ボタンをクリック
   - 確認ダイアログが表示されます

3. **シフト生成を実行**
   - 「生成する」ボタンをクリック
   - AIがシフトを自動生成します（通常5-10秒程度）
   - 生成中は「AIがシフトを生成中です...」と表示されます

4. **生成結果を確認**
   - シフト表が自動的に表示されます
   - カレンダー形式でスタッフごとのシフトを確認できます

#### 3.2.3 デモシフト生成

**AIを使わずに簡易的なシフトを生成したい場合**:

1. 「デモシフト生成」ボタンをクリック
2. ランダムなシフトが即座に生成されます
3. UIの確認やテスト用に使用できます

**注意**: デモシフトは制約条件を考慮しないため、実運用には使用しないでください。

---

### 3.3 休暇申請管理

#### 3.3.1 休暇申請の登録

1. **「休暇希望」タブをクリック**
   - メイン画面上部のタブから「休暇希望」を選択

2. **スタッフを選択**
   - ドロップダウンメニューから休暇を申請するスタッフを選択

3. **休暇日をカレンダーで選択**
   - カレンダー上の日付をクリック
   - 休暇タイプを選択:
     - **希望休**: スタッフの希望による休暇
     - **有給休暇**: 有給休暇（優先的に考慮されます）
     - **研修**: 研修参加のための休暇

4. **保存**
   - 選択した日付に休暇が登録されます
   - カレンダー上に色付きで表示されます

#### 3.3.2 休暇申請の削除

1. カレンダー上の休暇が登録されている日付をクリック
2. 「削除」ボタンをクリック
3. 休暇申請が削除されます

---

### 3.4 シフト要件設定

#### 3.4.1 時間帯の設定

1. **「設定」タブをクリック**
   - メイン画面上部のタブから「設定」を選択

2. **時間帯を追加**
   - 「時間帯を追加」ボタンをクリック
   - 時間帯名を入力（例：早番、日勤、遅番、夜勤）
   - 開始時刻と終了時刻を設定
   - 「追加」ボタンをクリック

3. **時間帯を編集**
   - 既存の時間帯をクリックして編集
   - 時刻を変更して「保存」

4. **時間帯を削除**
   - 時間帯の「削除」ボタンをクリック

#### 3.4.2 必要人員の設定

1. **各時間帯の必要人員を設定**
   - 時間帯ごとに以下を設定:
     - **必要人数**: 最低限必要なスタッフ数（例：3名）
     - **必要な役職**: 必須の役職（例：管理者 1名以上）
     - **必要な資格**: 必須の資格（例：介護福祉士 1名以上）

2. **自動保存**
   - 設定は自動的にFirestoreに保存されます（約1秒のデバウンス）

---

### 3.5 バージョン管理

#### 3.5.1 シフトの編集

1. **シフト表のセルをダブルクリック**
   - 編集したい日付のセルをダブルクリック
   - ドロップダウンメニューが表示されます

2. **シフトタイプを選択**
   - 早番、日勤、遅番、夜勤、休、明け休み から選択
   - 選択すると即座にシフトが更新されます

3. **自動保存**
   - 編集内容はLocalStorageに自動保存されます（3秒間隔）

#### 3.5.2 下書き保存

1. **「下書き保存」ボタンをクリック**
   - 編集中のシフトをFirestoreに保存します
   - ステータスは「下書き」となります

2. **保存確認**
   - 「シフトを下書き保存しました」とトーストメッセージが表示されます

#### 3.5.3 シフトの確定

1. **「確定」ボタンをクリック**
   - 編集が完了したシフトを確定します
   - ステータスが「下書き」から「確定」に変更されます

2. **バージョン履歴の作成**
   - 確定時に自動的にバージョン履歴が作成されます
   - 今後の変更は新しいバージョンとして記録されます

**注意**: 確定後もシフトの編集は可能ですが、すべての変更がバージョン履歴に記録されます。

#### 3.5.4 バージョン履歴の表示

1. **紫色の時計アイコンボタンをクリック**
   - シフト表の上部にある「バージョン履歴」ボタンをクリック

2. **履歴を確認**
   - バージョン番号
   - 作成日時
   - 作成者
   - 変更内容

#### 3.5.5 過去バージョンへの復元

1. **バージョン履歴モーダルを開く**
   - 紫色の時計アイコンボタンをクリック

2. **復元したいバージョンを選択**
   - バージョン一覧から復元したいバージョンの「復元」ボタンをクリック

3. **復元確認**
   - 確認ダイアログで「復元」をクリック

4. **新バージョンとして保存**
   - 復元されたシフトは新しいバージョンとして保存されます
   - 復元前の状態も履歴に保存されます

**注意**: 復元操作は取り消せません。復元前の状態に戻したい場合は、再度バージョン履歴から復元してください。

---

### 3.6 エクスポート機能

#### 3.6.1 CSV エクスポート

1. **「CSV エクスポート」ボタンをクリック**
   - 現在表示中のシフトをCSV形式でダウンロードします

2. **ファイルの確認**
   - ダウンロードフォルダに `shift_YYYYMM.csv` が保存されます
   - Excel や Google スプレッドシートで開けます

#### 3.6.2 PDF エクスポート

1. **「PDF エクスポート」ボタンをクリック**
   - 現在表示中のシフトをPDF形式でダウンロードします

2. **印刷・配布**
   - PDFファイルを印刷して掲示板に掲示
   - メールで配布

---

## 4. ロール別機能

### 4.1 ロールの種類

このシステムには4種類のロールがあります：

| ロール | 権限 |
|--------|------|
| **super-admin** | システム全体の管理権限。管理画面アクセス、全施設管理、全権限付与、ユーザー管理 |
| **admin** | 施設のシフト作成・編集・削除、スタッフ管理、同じ施設内のメンバー招待（editor/viewer権限のみ付与可） |
| **editor** | 施設のシフト作成・編集・閲覧、スタッフ情報の閲覧 |
| **viewer** | 施設のシフト閲覧のみ |

### 4.2 ロール別操作一覧

| 操作 | super-admin | admin | editor | viewer |
|------|-------------|-------|--------|--------|
| 管理画面アクセス | ✅ | ❌ | ❌ | ❌ |
| スタッフ追加・編集・削除 | ✅ | ✅ | ❌ | ❌ |
| シフト作成・編集 | ✅ | ✅ | ✅ | ❌ |
| シフト閲覧 | ✅ | ✅ | ✅ | ✅ |
| 休暇申請登録・削除 | ✅ | ✅ | ✅ | ❌ |
| 要件設定 | ✅ | ✅ | ❌ | ❌ |
| バージョン履歴表示 | ✅ | ✅ | ✅ | ✅ |
| バージョン復元 | ✅ | ✅ | ✅ | ❌ |
| メンバー招待 | ✅ | ✅（editor/viewerのみ） | ❌ | ❌ |

---

## 5. 管理画面（super-admin専用）

**アクセス**: https://ai-care-shift-scheduler.web.app/admin

### 5.1 ダッシュボード

管理画面のトップページでは、以下の統計情報を確認できます：
- 総施設数
- 総ユーザー数
- 総スタッフ数
- 総シフト数

### 5.2 施設管理

#### 5.2.1 施設一覧

1. **左メニューから「施設管理」をクリック**
2. **施設一覧が表示されます**:
   - 施設名
   - 作成日
   - メンバー数
   - ステータス

#### 5.2.2 新規施設の作成

1. **「新規施設作成」ボタンをクリック**
2. **施設情報を入力**:
   - 施設名
   - （オプション）説明
3. **「作成」ボタンをクリック**
4. 施設が作成されます

#### 5.2.3 施設詳細

1. 施設一覧から施設名をクリック
2. **施設詳細が表示されます**:
   - メンバー一覧（ユーザー名、メール、ロール）
   - シフトデータ統計
   - スタッフ数

### 5.3 ユーザー管理

#### 5.3.1 ユーザー一覧

1. **左メニューから「ユーザー管理」をクリック**
2. **ユーザー一覧が表示されます**:
   - ユーザー名
   - メールアドレス
   - 所属施設数
   - 最終ログイン日時

#### 5.3.2 ユーザー詳細

1. ユーザー一覧からユーザー名をクリック
2. **ユーザー詳細が表示されます**:
   - 所属施設とロール
   - アクセス履歴

#### 5.3.3 アクセス権限付与

1. **ユーザー詳細ページで「権限付与」ボタンをクリック**
2. **権限情報を入力**:
   - 施設を選択
   - ロールを選択（super-admin、admin、editor、viewer）
3. **「付与」ボタンをクリック**
4. ユーザーに権限が付与されます

**注意**:
- super-admin権限は慎重に付与してください
- admin権限ユーザーはeditor/viewerのみ付与できます

#### 5.3.4 アクセス権限剥奪

1. **ユーザー詳細ページで「権限剥奪」ボタンをクリック**
2. **施設を選択**
3. **「剥奪」ボタンをクリック**
4. ユーザーの権限が削除されます

### 5.4 監査ログ

#### 5.4.1 監査ログ一覧

1. **左メニューから「監査ログ」をクリック**
2. **すべてのCRUD操作が記録されています**:
   - 日時
   - ユーザーID
   - 操作種別（作成、更新、削除）
   - 対象リソース（スタッフ、シフト、ユーザーなど）
   - IPアドレス
   - ユーザーエージェント

#### 5.4.2 フィルタリング

1. **フィルター条件を設定**:
   - 日時範囲（開始日時、終了日時）
   - ユーザーID
   - 操作種別（create、update、delete）
   - 対象リソース（staff、schedule、user、facility、leave_request）

2. **「フィルター適用」ボタンをクリック**
3. フィルター結果が表示されます

#### 5.4.3 エクスポート

1. **「CSV エクスポート」ボタンをクリック**
   - 現在のフィルター結果をCSV形式でダウンロード

2. **「JSON エクスポート」ボタンをクリック**
   - 現在のフィルター結果をJSON形式でダウンロード

**用途**: コンプライアンス監査、セキュリティ調査

### 5.5 セキュリティアラート

#### 5.5.1 アラート一覧

1. **左メニューから「セキュリティアラート」をクリック**
2. **異常なアクセスパターンが検出されたアラートが表示されます**:
   - アラートタイプ（大量データエクスポート、通常外時間帯アクセスなど）
   - 重要度（high、medium、low）
   - ステータス（open、investigating、resolved、false_positive）
   - 検出日時

#### 5.5.2 アラート詳細

1. アラート一覧からアラートをクリック
2. **詳細情報が表示されます**:
   - ユーザーID
   - 検出理由
   - 関連する監査ログ
   - ノート（調査メモ）

#### 5.5.3 アラートのステータス更新

1. アラート詳細ページで「ステータス更新」ボタンをクリック
2. 新しいステータスを選択:
   - **investigating**: 調査中
   - **resolved**: 解決済み
   - **false_positive**: 誤検知
3. 「更新」ボタンをクリック

#### 5.5.4 ノートの追加

1. アラート詳細ページで「ノート追加」ボタンをクリック
2. 調査内容や対応内容を入力
3. 「追加」ボタンをクリック

#### 5.5.5 手動異常検知の実行

1. 「手動検知実行」ボタンをクリック
2. 最新の監査ログから異常なパターンを検知
3. 新しいアラートが作成されます（該当する場合）

---

## 6. よくある質問

### Q1. パスワードを忘れました

**A**: このシステムはGoogle OAuth認証を使用しているため、パスワード管理は不要です。Googleアカウントでログインしてください。Googleアカウントのパスワードを忘れた場合は、Googleのパスワード回復手続きを行ってください。

### Q2. ログインできません

**A**: 以下を確認してください：
1. Googleアカウントでログインしていますか？
2. アクセス権限を付与されていますか？（2人目以降のユーザーの場合）
3. インターネット接続は正常ですか？
4. ブラウザのキャッシュをクリアしてみてください

### Q3. シフトが生成されません

**A**: 以下を確認してください：
1. スタッフ情報が登録されていますか？
2. シフト要件が設定されていますか？
3. インターネット接続は正常ですか？
4. エラーメッセージが表示されている場合は、その内容を確認してください

### Q4. スタッフを削除してしまいました

**A**: 削除したスタッフは復元できません。再度登録してください。重要なデータは削除前に必ずバックアップ（CSV エクスポート）を取ることをお勧めします。

### Q5. シフトを間違えて確定してしまいました

**A**: 確定後もシフトの編集は可能です。また、バージョン履歴から過去のバージョンに復元することもできます（紫色の時計アイコンボタン）。

### Q6. 複数の施設を管理したいです

**A**: super-adminユーザーは管理画面から新規施設を作成できます。admin権限ユーザーは複数の施設にアクセス権限を付与されている場合、施設選択UIで切り替えることができます。

### Q7. CSVファイルが文字化けします

**A**: Excelで開く場合、UTF-8 BOMエンコーディングを使用しているため、通常は文字化けしません。それでも文字化けする場合は、Google スプレッドシートで開いてください。

### Q8. AIシフト生成が遅いです

**A**: 初回のAI生成は10-15秒程度かかる場合があります（Cloud Functionsのコールドスタート）。2回目以降はキャッシュが効いて高速化されます。また、スタッフ数が多い場合（50名以上）は生成に時間がかかることがあります。

### Q9. スマートフォンで使用できますか？

**A**: 現在のバージョンはデスクトップブラウザ向けに最適化されています。スマートフォンでも閲覧は可能ですが、一部の機能が使いにくい場合があります。モバイルアプリは今後のロードマップに含まれています。

### Q10. データのバックアップはどうすれば良いですか？

**A**: 以下の方法でバックアップできます：
1. **シフトデータ**: CSV エクスポートまたはPDF エクスポート
2. **監査ログ**: 管理画面からCSV/JSON エクスポート
3. すべてのデータはFirestoreに自動保存されているため、Googleのバックアップポリシーに従って保護されています

---

## 7. トラブルシューティング

### 7.1 ログインに関する問題

#### 問題: 「Googleでログイン」ボタンをクリックしても反応しない

**解決策**:
1. ブラウザのポップアップブロックを解除してください
2. ブラウザを再起動してください
3. キャッシュとCookieをクリアしてください

#### 問題: 「アクセス権限がありません」と表示される

**解決策**:
1. super-adminまたはadmin権限を持つユーザーに連絡してください
2. 権限付与を依頼してください
3. 権限付与後、一度ログアウトして再度ログインしてください

### 7.2 シフト生成に関する問題

#### 問題: 「AIがシフトを生成できませんでした」エラー

**解決策**:
1. スタッフ数が十分か確認してください（最低3名以上推奨）
2. シフト要件が厳しすぎないか確認してください
3. 再度「AIでシフト作成」ボタンをクリックしてください
4. それでも失敗する場合は、「デモシフト生成」を試してください

#### 問題: 生成されたシフトが不自然

**解決策**:
1. シフト要件を見直してください（必要人員、資格要件など）
2. スタッフの勤務条件を見直してください（週の勤務回数、連続勤務の上限など）
3. 休暇申請が正しく登録されているか確認してください
4. 手動でシフトを編集してください（セルをダブルクリック）

### 7.3 データに関する問題

#### 問題: リロード後にデータが消えた

**解決策**:
1. ログイン状態を確認してください（セッションが切れている可能性）
2. インターネット接続を確認してください
3. Firestoreへの保存が完了していたか確認してください（トーストメッセージ）

#### 問題: 下書き保存ができない

**解決策**:
1. インターネット接続を確認してください
2. ブラウザのコンソールでエラーメッセージを確認してください
3. 権限を確認してください（editor以上の権限が必要）

### 7.4 パフォーマンスに関する問題

#### 問題: 画面の読み込みが遅い

**解決策**:
1. インターネット接続速度を確認してください
2. ブラウザのキャッシュをクリアしてください
3. 他のタブを閉じてください
4. ブラウザを再起動してください

#### 問題: シフト表の表示が重い

**解決策**:
1. スタッフ数が非常に多い場合（100名以上）、表示に時間がかかることがあります
2. ブラウザのパフォーマンスモードを有効にしてください
3. 不要なブラウザ拡張機能を無効にしてください

### 7.5 管理画面に関する問題

#### 問題: 管理画面にアクセスできない（403エラー）

**解決策**:
1. super-admin権限を持っているか確認してください
2. ログアウトして再度ログインしてください
3. URLが正しいか確認してください（`/admin`）

#### 問題: 監査ログが表示されない

**解決策**:
1. フィルター条件を確認してください（日時範囲が適切か）
2. 「フィルタークリア」ボタンをクリックしてください
3. ページをリロードしてください

### 7.6 その他の問題

#### 問題: ブラウザコンソールに警告が表示される

**解決策**:
1. COOP（Cross-Origin-Opener-Policy）警告は非クリティカルです
2. 機能には影響しないため、無視して問題ありません
3. 次回のデプロイ時に自然に解消されます

#### 問題: エラーメッセージが表示される

**解決策**:
1. エラーメッセージの内容を確認してください
2. エラーメッセージをコピーして、サポートに問い合わせてください
3. ブラウザのコンソール（F12キー）でエラーの詳細を確認してください

---

## 8. お問い合わせ

### サポート窓口

**Email**: admin@fuku-no-tane.com
**GitHub Issues**: https://github.com/yasushi-honda/ai-care-shift-scheduler/issues

### サポート時間

平日 9:00 - 18:00（土日祝日を除く）

---

## 9. 更新履歴

| バージョン | 日付 | 内容 |
|-----------|------|------|
| 1.0 | 2025-11-12 | 初版作成 |

---

**本番環境**: https://ai-care-shift-scheduler.web.app

**© 2025 AIシフト自動作成システム. All rights reserved.**
