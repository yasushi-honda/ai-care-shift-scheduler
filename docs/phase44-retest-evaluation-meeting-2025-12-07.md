# Phase 44: Step 1.5 再テスト評価ミーティング議事録

**開催日時**: 2025-12-07 21:25
**参加者（シミュレーション）**:
- プロジェクトマネージャー（PM）
- バックエンドエンジニア（BE）
- AIエンジニア（AI）
- アルゴリズム専門家（ALG）
- QAエンジニア（QA）

**議題**: Step 1.5 改善後の再テスト結果評価

---

## 1. テスト結果比較

### QA: 前回 vs 今回の比較

| 指標 | Step 1 (前回) | Step 1.5 (今回) | 変化 | 目標 |
|------|---------------|-----------------|------|------|
| 処理時間 | 98秒 | **88秒** | -10秒 ✅ | 180秒以内 |
| HTTPステータス | 200 | 200 | - | 200 |
| 総合スコア | 0点 | **0点** | - | 80点以上 ❌ |
| 充足率 | 85% | **89%** | +4% ⬆️ | 100% |
| 制約違反 | 21件 | **18件** | -3件 ⬆️ | 0件 |
| 早番不足 | 17日 | **15日** | -2日 ⬆️ | 5日以下 |
| 遅番不足 | 3日 | **0日** | -3日 ✅ | 0日 |
| 看護師未配置 | 1日 | **3日** | +2日 ⬇️ | 0日 |
| 完璧な日 | 不明 | **11日(40%)** | - | 26日(100%) |

### 詳細分析

```
=== 日別配置サマリー ===
営業日数: 27日（※1日多い - 後述）
完璧な日: 11日 (40%)
早番不足: 15日
日勤不足: 0日
遅番不足: 0日
看護師未配置: 3日
```

---

## 2. 改善効果の評価

### AI: プロンプト改善の効果

**改善が見られた点**:
1. ✅ **遅番が完璧に配置** - 全26営業日で1名確保
2. ✅ **処理時間が10秒短縮** - より効率的な生成
3. ⬆️ **充足率が4%向上** - 85% → 89%
4. ⬆️ **制約違反が3件減少** - 21件 → 18件
5. ⬆️ **早番不足が2日減少** - 17日 → 15日

**悪化した点**:
1. ⬇️ **看護師未配置が増加** - 1日 → 3日
2. ⬇️ **営業日数が27日**になっている（本来26日のはず）

### ALG: 数学的分析

```
【シフト配分の変化】

Step 1:
- 早番: 35人日（不足17日）
- 日勤: 65人日（過剰13日）
- 遅番: 23人日（不足3日）

Step 1.5:
- 早番: 37人日（不足15日）⬆️ +2
- 日勤: 68人日（過剰16日）⬇️ +3 悪化
- 遅番: 27人日（±0日）✅ 完璧

【問題の本質】
プロンプトで「早番優先」と指示しても、
AIは依然として日勤を多く配置している。

日勤4名の日: 2日（1/10, 1/15）
日勤3名の日: 15日（悪い例を減らせていない）
```

### BE: 技術的観点

**問題1: 日曜日の扱い**

営業日数が27日と報告されているが、2026年1月のカレンダーでは：
- 日曜日: 1/4, 1/11, 1/18, 1/25 = 4日
- 営業日: 31 - 4 = 27日

→ これは**正しい計算**。前回の「26日」が間違っていた可能性。

**問題2: バッチ処理の限界**

現行のバッチ処理では：
- 1回目: 5名 × 31日を処理
- 2回目: 3名 × 31日を処理
- **日単位のバランス調整が不可能**

---

## 3. 根本原因の特定

### PM: 問題の整理

1. **プロンプト改善だけでは限界がある**
   - AIは指示を「参考」にするが、強制力がない
   - 「早番優先」と書いても、日勤に配置してしまう

2. **バッチ処理アーキテクチャの問題**
   - スタッフ軸の処理では、日単位の最適化ができない
   - 1日に何人が各シフトにいるか、を考慮できない

3. **構造的な変更が必要**
   - Step 2（週単位処理）への移行が必須

---

## 4. 決定事項

### 即時対応

1. **Step 2の実装を開始**
   - 週単位処理（1週間 × 8名）への変更
   - 各日の人員バランスを保証可能にする

2. **プロンプトのさらなる強化（暫定対応）**
   - より強い制約表現を使用
   - 「必ず」「絶対に」などの強調

### Step 2 実装方針

```typescript
// 現行: スタッフ軸バッチ処理
for (const staffBatch of staffBatches) {
  generateForStaffBatch(staffBatch, 31days); // 5名×31日
}

// Step 2: 週単位処理
for (const week of weeks) {
  generateForWeek(allStaff, week); // 8名×7日
}
```

**メリット**:
- 各日の人員バランスを直接制御可能
- 早番2名、日勤2名、遅番1名を1回の生成で保証
- 週内の連勤制約も同時に検証可能

---

## 5. 成功基準（Step 2 完了時）

| 指標 | 目標値 | 必須/努力 |
|------|--------|-----------|
| 充足率 | 100% | 必須 |
| 早番配置 | 26/26日（2名） | 必須 |
| 遅番配置 | 26/26日（1名） | 必須 |
| 看護師配置 | 26/26日（1名以上） | 必須 |
| 総合スコア | 80点以上 | 努力 |

---

## 6. 結論

### PM: 総括

**Step 1.5の評価**: 部分的改善
- 遅番問題は解決 ✅
- 早番問題は軽減したが未解決
- プロンプト改善だけでは限界

**次のステップ**: Step 2 実装へ移行
- 週単位処理アーキテクチャへの変更
- より構造的なアプローチで問題を解決

---

## 7. 添付資料

- [前回テストレポート](./phase44-test-report-2025-12-07.md)
- [前回評価ミーティング](./phase44-evaluation-meeting-2025-12-07.md)
- [技術仕様書](./ai-shift-generation-technical-spec-2025-12-07.md)
- [実装計画書](./ai-shift-generation-implementation-plan-2025-12-07.md)

---

## 8. Step 2 技術設計（予備検討）

### 週単位処理の設計

```
入力: 8名のスタッフ + 1週間の日付
出力: 各日×各スタッフのシフト

プロンプト例:
「以下の8名について、2026-01-05（月）〜2026-01-11（土）のシフトを生成してください。
各日の配置は必ず以下を満たすこと:
- 早番: 2名
- 日勤: 2名（看護師1名以上）
- 遅番: 1名
- 休み: 3名
※ 日曜日(1/11)は全員休み」
```

### 週間処理のメリット

1. **1回の生成で人員バランスを保証**
   - 8名全員を見て配置を決定
   - 各日の早番2名、日勤2名、遅番1名を直接指定

2. **連勤制約の検証が容易**
   - 1週間内の連勤状況を確認可能
   - 5連勤を超えないよう調整

3. **トークン効率の向上**
   - 1週間分のデータは比較的コンパクト
   - 8名 × 7日 = 56セル（vs 5名 × 31日 = 155セル）

---

**議事録作成者**: PM
**承認**: 全参加者

