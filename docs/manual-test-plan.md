# AIシフト自動作成システム - 手動テスト計画書

**作成日**: 2025-12-05
**対象バージョン**: Phase 41完了時点
**本番環境URL**: https://ai-care-shift-scheduler.web.app

---

## 目次

1. [テスト概要](#1-テスト概要)
2. [自動テストカバレッジ](#2-自動テストカバレッジ)
3. [手動テストの目的](#3-手動テストの目的)
4. [事前準備](#4-事前準備)
5. [手動テストケース](#5-手動テストケース)
6. [テスト結果報告フォーマット](#6-テスト結果報告フォーマット)
7. [不具合報告フォーマット](#7-不具合報告フォーマット)

---

## 1. テスト概要

### 1.1 プロジェクト状況

| 項目 | 状況 |
|-----|------|
| 現在のPhase | Phase 41完了 |
| 開発期間 | 2025-10-23 〜 現在（約2ヶ月） |
| E2Eテスト | 18ファイル、自動化済み |
| ユニットテスト | Cloud Functions、フロントエンド一部 |

### 1.2 実装済み主要機能

| Phase | 機能 | E2Eテスト |
|-------|------|----------|
| 0-12 | 認証、Firestore、UI基盤 | ✅ あり |
| 13-17 | AI統合（Gemini API） | ✅ あり（CIスキップ） |
| 18-26 | 実績入力効率化（86%削減） | ✅ あり |
| 27-37 | キーボード操作、Undo/Redo | ✅ あり |
| 38-39 | シフト種別設定、休暇残高 | 一部 |
| 40 | AI評価・フィードバック | 一部 |
| 41 | 月次レポート、PDF出力 | ✅ あり |

---

## 2. 自動テストカバレッジ

### 2.1 E2Eテスト一覧

| ファイル | テスト対象 | テスト数 |
|---------|----------|---------|
| `auth-flow.spec.ts` | ログイン/ログアウト、権限チェック | 5 |
| `staff-management.spec.ts` | スタッフCRUD | 6 |
| `ai-shift-generation.spec.ts` | AI生成UI（CIスキップ） | 4 |
| `shift-creation.spec.ts` | シフト作成 | - |
| `double-click-shift.spec.ts` | ダブルクリック編集 | - |
| `planned-actual-shift-edit.spec.ts` | 予定/実績編集 | - |
| `copy-scheduled-button.spec.ts` | 予定→実績コピー | - |
| `bulk-copy-scheduled-to-actual.spec.ts` | 一括コピー機能 | 9 |
| `leave-request.spec.ts` | 休暇希望 | - |
| `version-management.spec.ts` | バージョン管理 | - |
| `report-page.spec.ts` | 月次レポート | 12 |
| `rbac-permissions.spec.ts` | RBAC権限 | - |
| `permission-errors.spec.ts` | 権限エラー | - |
| `invitation-flow.spec.ts` | 招待フロー | - |
| `data-crud.spec.ts` | データCRUD | - |
| `data-restoration.spec.ts` | データ復元 | - |
| `mobile-separate-page.spec.ts` | モバイル | - |

### 2.2 自動テストでカバー済み（手動テスト不要）

以下の機能は自動テストで十分にカバーされているため、**手動テストの優先度は低い**：

- ✅ ログイン/ログアウトの基本フロー
- ✅ 権限なしアクセス → Forbiddenページ
- ✅ スタッフの追加/編集/削除
- ✅ 一括コピーモーダルの開閉
- ✅ 一括コピーのバリデーション（スタッフ未選択、日付範囲エラー）
- ✅ レポートページのタブ切り替え
- ✅ レスポンシブ（ビューポートサイズ変更）

---

## 3. 手動テストの目的

### 3.1 手動テストが必要な理由

1. **実際のAI生成動作** - E2EテストはCIでスキップ（コスト削減）
2. **本番環境固有の問題** - デプロイ後のキャッシュ、CDN、SSL
3. **視覚的品質** - レイアウト崩れ、色、フォント
4. **操作感（UX）** - 応答速度、アニメーション、フィードバック
5. **エッジケース** - 大量データ、長時間操作、ネットワーク遅延
6. **クロスブラウザ/デバイス** - E2Eは単一ブラウザのみ

### 3.2 手動テストの優先度

| 優先度 | 領域 | 理由 |
|--------|-----|------|
| **最高** | AI生成（本番環境） | CIでスキップ、コストがかかる |
| **高** | PDF出力（実際のファイル確認） | 日本語、レイアウト |
| **高** | クロスブラウザ | Safari、Firefox |
| **中** | モバイル実機 | タッチ操作、小画面 |
| **中** | 評価パネル（Phase 40） | 新機能 |
| **低** | 基本機能 | E2Eでカバー済み |

---

## 4. 事前準備

### 4.1 テストアカウント

| 役割 | 説明 | 必要な権限 |
|------|-----|-----------|
| Admin | super-admin | 管理画面、全機能 |
| Manager | 事業所admin | シフト生成、スタッフ管理 |
| Staff | viewer | 閲覧のみ |

### 4.2 テストデータ

テスト開始前に以下を確認：
- [ ] テスト用事業所が存在
- [ ] スタッフが5名以上登録
- [ ] 当月のシフトデータが存在（または「デモシフト作成」で生成可能）

### 4.3 環境チェックリスト

- [ ] 本番環境 https://ai-care-shift-scheduler.web.app にアクセス可能
- [ ] テストアカウントでログイン可能
- [ ] ブラウザのキャッシュをクリア（Cmd+Shift+R）
- [ ] 開発者ツールを開く準備（コンソールエラー確認用）

---

## 5. 手動テストケース

### 5.1 優先度：最高（必須）

#### MT-001: AI自動シフト生成（本番環境）

**目的**: 実際のVertex AI Gemini 2.5 Flashによるシフト生成を検証

**前提条件**:
- Manager以上でログイン
- スタッフ5名以上登録済み

**手順**:
1. シフト表画面を表示
2. 「シフト作成実行」または「デモシフト作成」ボタンをクリック
3. ローディング表示を確認
4. 生成完了を待つ（60秒以内が目安）

**確認項目**:
- [ ] ローディング中に「AIがシフトを作成中...」表示
- [ ] 生成完了後、シフト表にデータが表示
- [ ] 生成時間が妥当（30秒以内が理想、60秒以内が許容）
- [ ] コンソールにエラーなし
- [ ] 評価パネルにスコア（0-100）が表示される（Phase 40）

**備考**:
- AI生成は実際にVertex AIを呼び出すためコストがかかる
- 1回の生成でテスト完了とする

---

#### MT-002: AI評価パネル（Phase 40）

**目的**: AI生成結果の評価機能を検証

**前提条件**:
- MT-001でシフト生成済み

**手順**:
1. シフト生成完了後、評価パネルを確認

**確認項目**:
- [ ] 総合スコア（0-100）が表示される
- [ ] 充足率が表示される
- [ ] 制約違反がある場合、警告/エラーが色分けで表示
- [ ] 改善提案が表示される
- [ ] 折りたたみ/展開が動作する

---

#### MT-003: PDF出力（日本語確認）

**目的**: PDFファイルの日本語表示とレイアウトを検証

**前提条件**:
- レポートページ（/reports）にアクセス可能
- シフトデータが存在

**手順**:
1. /reports にアクセス
2. 「PDF出力」ボタンをクリック
3. ダウンロードされたPDFを開く

**確認項目**:
- [ ] PDFファイルがダウンロードされる
- [ ] 日本語が文字化けしていない
- [ ] テーブル/グラフが含まれている
- [ ] レイアウトが崩れていない
- [ ] 印刷プレビューで問題なし

---

### 5.2 優先度：高

#### MT-004: クロスブラウザ（Safari）

**目的**: Safari固有の問題を検出

**環境**: macOS Safari最新版

**確認項目**:
- [ ] ログイン/ログアウトが動作
- [ ] シフト表が正常表示
- [ ] キーボード操作（矢印キー、Tab、Ctrl+Z）が動作
- [ ] PDFダウンロードが動作
- [ ] レイアウト崩れがない

---

#### MT-005: クロスブラウザ（Firefox）

**目的**: Firefox固有の問題を検出

**環境**: Firefox最新版

**確認項目**:
- [ ] ログイン/ログアウトが動作
- [ ] シフト表が正常表示
- [ ] キーボード操作が動作
- [ ] PDFダウンロードが動作

---

#### MT-006: モバイル実機（iOS Safari）

**目的**: モバイル実機での動作を検証

**環境**: iPhone（iOS Safari）

**確認項目**:
- [ ] ログイン画面が表示される
- [ ] タッチ操作でシフト編集可能
- [ ] タブ切り替えが動作
- [ ] レスポンシブレイアウトが適切
- [ ] フォントサイズが読みやすい

---

#### MT-007: モバイル実機（Android Chrome）

**目的**: Androidでの動作を検証

**環境**: Android Chrome

**確認項目**:
- [ ] ログイン画面が表示される
- [ ] タッチ操作が動作
- [ ] レスポンシブレイアウトが適切

---

### 5.3 優先度：中

#### MT-008: 月次レポート全タブ確認

**目的**: Phase 41で追加されたレポート機能を検証

**手順**:
1. /reports にアクセス
2. 各タブをクリック（ダッシュボード、勤務時間、シフト種別、スタッフ稼働）

**確認項目**:
- [ ] ダッシュボード: サマリーカードが表示
- [ ] 勤務時間: スタッフ別の勤務時間一覧
- [ ] シフト種別: 円グラフと内訳テーブル
- [ ] スタッフ稼働: 個人詳細とカレンダー
- [ ] 経営分析（管理者のみ）: コスト推計、前月比較
- [ ] 個人レポート（スタッフ用）: 本人のデータのみ

---

#### MT-009: キーボード操作（全機能）

**目的**: Phase 27-37で追加されたキーボード機能を検証

**手順**:
1. シフト表でセルを選択
2. 各キーボード操作を試す

**確認項目**:
- [ ] 矢印キー（↑↓←→）: セル移動
- [ ] Tab: 次セルに移動
- [ ] Shift+Tab: 前セルに移動
- [ ] Enter: 編集確定
- [ ] Escape: 編集キャンセル
- [ ] Ctrl+Z (Cmd+Z): Undo
- [ ] Ctrl+Shift+Z (Cmd+Shift+Z): Redo
- [ ] Home: 行頭へ移動
- [ ] End: 行末へ移動
- [ ] Ctrl+↑↓←→: ジャンプ移動
- [ ] PageUp/PageDown: ページ移動
- [ ] ?キー: ヘルプモーダル表示

---

#### MT-010: シフト種別設定（Phase 38）

**目的**: カスタムシフト種別の設定を検証

**手順**:
1. シフト種別設定画面を開く
2. 新しいシフト種別を追加

**確認項目**:
- [ ] 設定画面が開く
- [ ] 新規シフト種別を追加できる
- [ ] 時間（開始/終了）を設定できる
- [ ] 色を設定できる
- [ ] 保存後、シフト表で使用可能

---

#### MT-011: 休暇残高管理（Phase 39）

**目的**: 公休/有給の残高管理を検証

**手順**:
1. 休暇残高ダッシュボードを表示
2. 残高設定を確認

**確認項目**:
- [ ] 公休残高が表示される
- [ ] 有給残高が表示される
- [ ] 休暇使用時に残高が減算される
- [ ] 残高不足時に警告が出る（設定による）

---

### 5.4 優先度：低（時間があれば）

#### MT-012: 管理者機能（/admin）

**目的**: 管理画面の基本動作を確認

**前提条件**: super-admin権限でログイン

**確認項目**:
- [ ] /admin にアクセス可能
- [ ] ユーザー一覧が表示
- [ ] 事業所一覧が表示
- [ ] 監査ログが表示

---

#### MT-013: データエクスポート

**目的**: CSVエクスポートを検証

**手順**:
1. シフト表で「エクスポート」→「CSV」を選択

**確認項目**:
- [ ] CSVファイルがダウンロードされる
- [ ] 日本語が文字化けしない（Excel、Numbersで開いて確認）
- [ ] データが正確

---

#### MT-014: バージョン履歴・復元

**目的**: シフトのバージョン管理を検証

**手順**:
1. シフトを編集・保存
2. 「履歴」ボタンをクリック
3. 過去バージョンを選択して復元

**確認項目**:
- [ ] バージョン一覧が表示される
- [ ] 過去バージョンを選択できる
- [ ] 復元が正常に動作

---

## 6. テスト結果報告フォーマット

### 日次報告テンプレート

```markdown
# 手動テスト結果報告

**テスト日**: YYYY-MM-DD
**テスター**: 名前
**環境**: Chrome 120 / macOS Sonoma

## サマリー

| 項目 | 数 |
|------|-----|
| 実施 | X |
| 合格 | X |
| 不合格 | X |
| 未実施 | X |

## 結果一覧

| ID | テストケース | 結果 | 備考 |
|----|-------------|------|------|
| MT-001 | AI自動生成 | ✅ | 生成時間25秒 |
| MT-002 | 評価パネル | ✅ | |
| MT-003 | PDF出力 | ❌ | 日本語一部文字化け |

## 発見した不具合

| ID | 概要 | 重要度 | 関連MT |
|----|-----|--------|--------|
| BUG-001 | PDF日本語文字化け | 中 | MT-003 |

## 所感・改善提案

-
```

---

## 7. 不具合報告フォーマット

```markdown
# 不具合報告

**ID**: BUG-XXX
**報告日**: YYYY-MM-DD
**報告者**: 名前
**関連テスト**: MT-XXX

## 概要
（1行で不具合を説明）

## 重要度
- [ ] 緊急: システム停止、データ損失
- [ ] 高: 主要機能が使用不可
- [ ] 中: 機能は使えるが問題あり
- [ ] 低: 軽微なUI問題

## 再現手順
1.
2.
3.

## 期待結果
（本来どうなるべきか）

## 実際の結果
（実際に何が起きたか）

## 環境
- ブラウザ:
- OS:
- デバイス:

## スクリーンショット
（可能であれば添付）

## コンソールエラー
```
（エラーがあれば貼り付け）
```

## 追加情報
（その他関連情報）
```

---

## 付録: テスト進捗管理表

### 必須テスト（Phase 1）

| ID | テストケース | 担当 | 実施日 | 結果 | 備考 |
|----|-------------|------|--------|------|------|
| MT-001 | AI自動生成 | | | | |
| MT-002 | 評価パネル | | | | |
| MT-003 | PDF出力 | | | | |

### クロスブラウザ/デバイス（Phase 2）

| ID | テストケース | 担当 | 実施日 | 結果 | 備考 |
|----|-------------|------|--------|------|------|
| MT-004 | Safari | | | | |
| MT-005 | Firefox | | | | |
| MT-006 | iOS実機 | | | | |
| MT-007 | Android実機 | | | | |

### 機能詳細（Phase 3）

| ID | テストケース | 担当 | 実施日 | 結果 | 備考 |
|----|-------------|------|--------|------|------|
| MT-008 | レポート全タブ | | | | |
| MT-009 | キーボード操作 | | | | |
| MT-010 | シフト種別設定 | | | | |
| MT-011 | 休暇残高管理 | | | | |

---

**ドキュメント終了**
