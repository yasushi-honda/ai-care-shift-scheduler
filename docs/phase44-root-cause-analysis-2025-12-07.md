# Phase 44: 根本原因分析 - 緊急チームミーティング

**開催日時**: 2025-12-07 21:40
**議題**: シフト生成失敗の根本原因特定 - デモデータ問題 vs AI性能問題

---

## 1. 問題提起

**PM**: これまでStep 1、Step 1.5とプロンプト改善を重ねてきたが、依然として早番不足が解消されない。そもそもの問題を切り分ける必要がある。

**質問**:
- デモデータ側に問題があるのか？
- それともAIの性能が悪いのか？

---

## 2. 数学的分析

### ALG: 制約充足問題としての分析

#### 2.1 需要側（必要人日数）

```
営業日数: 27日（2026年1月、日曜4日除外）

1日あたり必要人員:
  早番: 2名
  日勤: 2名（うち看護師1名以上）
  遅番: 1名
  合計: 5名

月間必要人日数:
  早番: 27 × 2 = 54人日
  日勤: 27 × 2 = 54人日
  遅番: 27 × 1 = 27人日
  合計: 135人日
```

#### 2.2 供給側（スタッフ勤務可能日数）

| スタッフ | 希望週勤 | 月間(希望) | シフト制約 | 備考 |
|----------|----------|------------|------------|------|
| 田中太郎 | 5日 | 22日 | **日勤のみ** | 管理者 |
| 佐藤花子 | 5日 | 22日 | いつでも可 | 看護師 |
| 鈴木美咲 | 4日 | 18日 | いつでも可 | 看護師 |
| 高橋健太 | 5日 | 22日 | いつでも可 | 介護職員 |
| 伊藤真理 | 5日 | 22日 | いつでも可 | 介護職員 |
| 渡辺翔太 | 5日 | 22日 | いつでも可 | 介護職員 |
| 山本さくら | 4日 | 18日 | いつでも可 | 介護職員 |
| 近藤理恵 | 5日 | 22日 | **日勤のみ** | 機能訓練指導員 |

**合計供給: 168人日**（需要135人日を上回る）

---

## 3. 問題の発見

### ALG: 日勤への過剰配置問題

```
【日勤に配置される人日数の計算】

① 日勤のみスタッフ（田中 + 近藤）
   → 22 + 22 = 44人日（日勤固定）

② 看護師の日勤配置（佐藤 or 鈴木）
   → 毎日1名必要 × 27日 = 27人日（日勤優先）

③ 日勤に流れる合計
   → 44 + 27 = 71人日

【日勤の需要】
   → 54人日

【問題】
   → 71 - 54 = 17人日が日勤に過剰配置！
```

### BE: 実際のAI出力との照合

Step 1.5のテスト結果:
```
早番合計: 39人日（必要54人日）→ 15人日不足
日勤合計: 73人日（必要54人日）→ 19人日過剰
遅番合計: 29人日（必要27人日）→ 2人日過剰
```

**ALGの数学モデルとほぼ一致！** AIは制約に従って最善を尽くしている。

---

## 4. 根本原因の特定

### 結論: **デモデータの設計問題**

```
┌─────────────────────────────────────────────────────────┐
│  これはAI性能の問題ではなく、デモデータの設計問題です   │
└─────────────────────────────────────────────────────────┘
```

#### 問題1: 日勤のみスタッフが多すぎる

```
田中太郎: timeSlotPreference = "日勤のみ"
近藤理恵: timeSlotPreference = "日勤のみ"

→ 2名で44人日が日勤に固定
→ 日勤必要数54人日の81%を占める
→ 残り10人日しか他のスタッフを日勤に入れられない
```

#### 問題2: 看護師の日勤制約

```
日勤に看護師1名以上が必要（要件定義より）

佐藤花子（看護師）: 22人日
鈴木美咲（看護師）: 18人日

→ 看護師も日勤に配置される
→ 早番・遅番に回せる看護師の日数が減る
```

#### 問題3: 早番・遅番の人員不足

```
早番 + 遅番の必要人日数: 54 + 27 = 81人日

早番・遅番に入れるスタッフ:
  高橋健太: 22日
  伊藤真理: 22日
  渡辺翔太: 22日
  山本さくら: 18日
  合計: 84人日

ただし、これらのスタッフも日勤に入る必要がある（田中・近藤だけでは54人日に届かない）
→ 実質的に早番・遅番に回せるのは72人日程度
→ 81人日必要なので、9人日不足！
```

---

## 5. 解決策の検討

### PM: 選択肢の整理

| 選択肢 | 内容 | 効果 | リスク |
|--------|------|------|--------|
| A | 田中or近藤を「いつでも可」に変更 | 高 | 役職設定との整合性 |
| B | 早番必要人数を1名に削減 | 高 | 業務要件との整合性 |
| C | スタッフを追加（9名以上に） | 高 | データ増加 |
| D | 看護師を早番にも配置 | 中 | 要件変更が必要 |

### AI: 推奨案

**選択肢A: 近藤理恵を「いつでも可」に変更**

理由:
1. 機能訓練指導員は日勤のみの制約がなくても自然
2. 田中太郎（管理者）は日勤のみのほうが現実的
3. 1名変更するだけで22人日の柔軟性が生まれる

```typescript
// 変更前
{
  "id": "staff-kondo",
  "name": "近藤理恵",
  "timeSlotPreference": "日勤のみ"  // ← これが問題
}

// 変更後
{
  "id": "staff-kondo",
  "name": "近藤理恵",
  "timeSlotPreference": "いつでも可"  // ← 修正
}
```

---

## 6. 数学的検証（修正後）

### ALG: 修正後の制約計算

```
【日勤に配置される人日数（修正後）】

① 日勤のみスタッフ（田中のみ）
   → 22人日（日勤固定）

② 看護師の日勤配置（佐藤 or 鈴木）
   → 27人日（日勤優先）

③ 日勤に流れる合計
   → 22 + 27 = 49人日

【日勤の需要】
   → 54人日

【残り必要】
   → 54 - 49 = 5人日
   → 他のスタッフから5人日を日勤に配置すればOK

【早番・遅番に回せる人日数】
近藤: 22日が解放される
+ 高橋・伊藤・渡辺・山本: 84日から日勤5日を引いて79日

合計: 22 + 79 = 101人日

必要: 81人日（早番54 + 遅番27）

余裕: 20人日 → 十分に実現可能！
```

---

## 7. 決定事項

### 即時対応

1. **デモデータの修正**
   - 近藤理恵の`timeSlotPreference`を「日勤のみ」→「いつでも可」に変更
   - テストスクリプトも更新

2. **再テスト実施**
   - 修正後のデモデータでシフト生成を実行
   - Step 2（週単位処理）は一旦保留

### 確認事項

- AI性能には問題なし
- プロンプト改善も効果あり（遅番は完璧に配置された）
- 問題はデモデータの制約設計

---

## 8. 学びと振り返り

### チーム全体

1. **数学的検証の重要性**
   - 実装前に制約の実現可能性を計算すべきだった
   - 「供給 > 需要」だけでは不十分、シフト区分ごとの検証が必要

2. **問題の切り分け**
   - AI性能 vs データ設計 を早期に切り分けるべきだった
   - Step 2実装に着手する前に気づけてよかった

3. **ドキュメントドリブンの効果**
   - 数値で可視化することで問題が明確になった
   - チームで共通認識を持てた

---

## 9. 添付資料

### 分析スクリプト出力

```
============================================================
Phase 44: 根本原因分析 - デモデータ vs AI性能
============================================================

** DAY SHIFT ALLOCATION **
  Day shift required: 54 person-days
  Day-only staff (Tanaka+Kondo): 44 person-days
  Nurse requirement (1/day): 27 person-days
  Total going to day shift: 44 + 27 = 71 person-days
  EXCESS: 17 person-days!

** EARLY/LATE SHIFT SHORTAGE **
  Early + Late required: 54 + 27 = 81 person-days
  Non-nurse staff total: 84 person-days
  Early+Late required: 81 person-days
  SHORTAGE: Mathematically tight, requires optimal distribution

============================================================
[CONCLUSION]
============================================================

THIS IS A DEMO DATA DESIGN PROBLEM, NOT AN AI PERFORMANCE ISSUE.
```

---

**議事録作成者**: PM
**承認**: 全参加者

