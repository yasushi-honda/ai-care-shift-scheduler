<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>操作マニュアル - AIシフト自動作成システム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            line-height: 1.8;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .back-link {
            display: inline-block;
            margin: 20px 0;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        h2 {
            color: #667eea;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 1.8em;
        }

        h3 {
            color: #764ba2;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        p {
            margin-bottom: 15px;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .note {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }

        .warning {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
        }

        .success {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
        }

        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .toc h3 {
            margin-top: 0;
            color: #667eea;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 5px;
        }

        .badge-admin {
            background-color: #dc3545;
            color: white;
        }

        .badge-editor {
            background-color: #ffc107;
            color: #333;
        }

        .badge-viewer {
            background-color: #6c757d;
            color: white;
        }

        footer {
            margin-top: 60px;
            padding: 20px;
            text-align: center;
            background-color: #f8f9fa;
            color: #6c757d;
        }

        @media print {
            .back-link {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>📖 操作マニュアル</h1>
        <p>AIシフト自動作成システム</p>
        <p style="font-size: 0.9em; margin-top: 10px;">バージョン 1.0 | 更新日: 2025年11月12日</p>
    </header>

    <div class="container">
        <a href="/" class="back-link">← アプリに戻る</a>

        <div class="toc">
            <h3>📚 目次</h3>
            <ul>
                <li><a href="#section1">1. はじめに</a></li>
                <li><a href="#section2">2. ログイン方法</a></li>
                <li><a href="#section3">3. 基本操作</a>
                    <ul style="margin-left: 20px;">
                        <li><a href="#section3-1">3.1 スタッフ管理</a></li>
                        <li><a href="#section3-2">3.2 シフト作成</a></li>
                        <li><a href="#section3-3">3.3 休暇申請管理</a></li>
                        <li><a href="#section3-4">3.4 シフト要件設定</a></li>
                        <li><a href="#section3-5">3.5 バージョン管理</a></li>
                        <li><a href="#section3-6">3.6 エクスポート機能</a></li>
                    </ul>
                </li>
                <li><a href="#section4">4. ロール別機能</a></li>
                <li><a href="#section5">5. 管理画面（super-admin専用）</a></li>
                <li><a href="#section6">6. よくある質問</a></li>
                <li><a href="#section7">7. トラブルシューティング</a></li>
            </ul>
        </div>

        <h2 id="section1">1. はじめに</h2>

        <h3>1.1 AIシフト自動作成システムとは？</h3>
        <p>AIシフト自動作成システムは、介護・福祉事業所のシフト作成業務を効率化するWebアプリケーションです。Google の最新AI「Gemini」を活用し、スタッフの資格・希望・労働基準法を考慮した最適なシフトを自動生成します。</p>

        <h3>1.2 主な機能</h3>
        <ul>
            <li>✅ <strong>Google OAuth認証</strong>: Googleアカウントでログイン（パスワード管理不要）</li>
            <li>✅ <strong>スタッフ管理</strong>: スタッフ情報の登録・編集・削除</li>
            <li>✅ <strong>AIシフト自動生成</strong>: 制約条件を考慮した最適シフトを自動作成</li>
            <li>✅ <strong>休暇申請管理</strong>: カレンダー形式で休暇希望を簡単登録</li>
            <li>✅ <strong>バージョン管理</strong>: シフトの履歴管理と過去バージョンへの復元</li>
            <li>✅ <strong>権限管理</strong>: ロールベースのアクセス制御（super-admin/admin/editor/viewer）</li>
            <li>✅ <strong>CSVエクスポート</strong>: 既存システムへの連携</li>
        </ul>

        <h3>1.3 推奨環境</h3>
        <ul>
            <li><strong>ブラウザ</strong>: Google Chrome（最新版）、Microsoft Edge（最新版）、Safari（最新版）</li>
            <li><strong>インターネット接続</strong>: 必須</li>
            <li><strong>Googleアカウント</strong>: 必須</li>
        </ul>

        <h2 id="section2">2. ログイン方法</h2>

        <h3>2.1 初回ログイン</h3>
        <ol>
            <li><strong>本番環境にアクセス</strong><br>
                ブラウザで <a href="https://ai-care-shift-scheduler.web.app" target="_blank">https://ai-care-shift-scheduler.web.app</a> を開く
            </li>
            <li><strong>Googleでログイン</strong><br>
                「Googleでログイン」ボタンをクリックし、Googleアカウントを選択
            </li>
            <li><strong>権限許可</strong><br>
                「許可」をクリック
            </li>
            <li><strong>ログイン完了</strong><br>
                <div class="note">
                    <strong>初回ユーザーの場合</strong>: 自動的にsuper-admin権限が付与され、メイン画面が表示されます<br>
                    <strong>2人目以降のユーザーの場合</strong>: 「アクセス権限がありません。管理者に連絡してください」画面が表示されます
                </div>
            </li>
        </ol>

        <h3>2.2 ログアウト</h3>
        <ol>
            <li>画面右上のユーザー名またはプロフィール画像をクリック</li>
            <li>ドロップダウンメニューから「ログアウト」を選択</li>
        </ol>

        <h2 id="section3">3. 基本操作</h2>

        <h3 id="section3-1">3.1 スタッフ管理</h3>

        <h4>スタッフの追加</h4>
        <ol>
            <li>「スタッフ追加」ボタン（緑色）をクリック</li>
            <li>スタッフ情報を入力:
                <ul>
                    <li><strong>名前</strong>: 例）田中太郎</li>
                    <li><strong>役職</strong>: 管理者、看護師、介護士、調理員、事務員</li>
                    <li><strong>資格</strong>: 介護福祉士、看護師、准看護師など（複数選択可）</li>
                </ul>
            </li>
            <li>勤務条件を設定:
                <ul>
                    <li><strong>週の勤務回数</strong>: 希望と必須最低を設定</li>
                    <li><strong>連続勤務の上限</strong>: 例）5日</li>
                    <li><strong>勤務可能曜日</strong>: チェックボックスで選択</li>
                    <li><strong>時間帯希望</strong>: 日勤のみ、夜勤のみなど</li>
                </ul>
            </li>
            <li>「保存」ボタンをクリック</li>
        </ol>

        <h4>スタッフの編集・削除</h4>
        <ul>
            <li><strong>編集</strong>: スタッフリストの「編集」ボタンをクリック → 情報修正 → 「保存」</li>
            <li><strong>削除</strong>: スタッフリストの「削除」ボタンをクリック → 確認ダイアログで「削除」</li>
        </ul>

        <div class="warning">
            <strong>⚠️ 注意</strong>: 削除したスタッフは復元できません。慎重に操作してください。
        </div>

        <h3 id="section3-2">3.2 シフト作成</h3>

        <h4>AIシフト自動生成</h4>
        <ol>
            <li>対象月を選択（◀ 2025年11月 ▶）</li>
            <li>「AIでシフト作成」ボタン（青色）をクリック</li>
            <li>確認ダイアログで「生成する」をクリック</li>
            <li>AIがシフトを自動生成（通常5-10秒程度）</li>
            <li>シフト表が表示されます</li>
        </ol>

        <div class="success">
            <strong>✅ AIシフト生成の特長</strong>:
            <ul style="margin-top: 10px;">
                <li>スタッフの資格・役職要件を自動考慮</li>
                <li>連続勤務制限を遵守</li>
                <li>夜勤後の休息確保（明け休み + 公休）</li>
                <li>休暇希望を優先的に考慮</li>
            </ul>
        </div>

        <h3 id="section3-3">3.3 休暇申請管理</h3>

        <h4>休暇申請の登録</h4>
        <ol>
            <li>「休暇希望」タブをクリック</li>
            <li>スタッフを選択（ドロップダウンメニュー）</li>
            <li>カレンダー上の日付をクリック</li>
            <li>休暇タイプを選択:
                <ul>
                    <li><strong>希望休</strong>: スタッフの希望による休暇</li>
                    <li><strong>有給休暇</strong>: 有給休暇（優先的に考慮）</li>
                    <li><strong>研修</strong>: 研修参加のための休暇</li>
                </ul>
            </li>
            <li>カレンダー上に色付きで表示されます</li>
        </ol>

        <h4>休暇申請の削除</h4>
        <p>カレンダー上の休暇が登録されている日付をクリック → 「削除」ボタンをクリック</p>

        <h3 id="section3-4">3.4 シフト要件設定</h3>

        <ol>
            <li>「設定」タブをクリック</li>
            <li>時間帯を追加:
                <ul>
                    <li>時間帯名（例：早番、日勤、遅番、夜勤）</li>
                    <li>開始時刻と終了時刻を設定</li>
                </ul>
            </li>
            <li>各時間帯の必要人員を設定:
                <ul>
                    <li><strong>必要人数</strong>: 例）3名</li>
                    <li><strong>必要な役職</strong>: 例）管理者 1名以上</li>
                    <li><strong>必要な資格</strong>: 例）介護福祉士 1名以上</li>
                </ul>
            </li>
            <li>設定は自動的に保存されます</li>
        </ol>

        <h3 id="section3-5">3.5 バージョン管理</h3>

        <h4>シフトの編集</h4>
        <ol>
            <li>シフト表のセルをダブルクリック</li>
            <li>ドロップダウンメニューからシフトタイプを選択（早番、日勤、遅番、夜勤、休、明け休み）</li>
            <li>自動的にLocalStorageに保存されます（3秒間隔）</li>
        </ol>

        <h4>下書き保存と確定</h4>
        <ul>
            <li><strong>下書き保存</strong>: 「下書き保存」ボタンをクリック → Firestoreに保存</li>
            <li><strong>確定</strong>: 「確定」ボタンをクリック → バージョン履歴が作成されます</li>
        </ul>

        <h4>バージョン履歴の表示と復元</h4>
        <ol>
            <li>紫色の時計アイコンボタン（バージョン履歴）をクリック</li>
            <li>バージョン一覧が表示されます（バージョン番号、作成日時、作成者）</li>
            <li>復元したいバージョンの「復元」ボタンをクリック</li>
            <li>新しいバージョンとして保存されます</li>
        </ol>

        <div class="note">
            <strong>📝 注意</strong>: 復元操作は取り消せません。復元前の状態に戻したい場合は、再度バージョン履歴から復元してください。
        </div>

        <h3 id="section3-6">3.6 エクスポート機能</h3>

        <ul>
            <li><strong>CSV エクスポート</strong>: 「CSV エクスポート」ボタンをクリック → <code>shift_YYYYMM.csv</code> がダウンロードされます</li>
            <li><strong>PDF エクスポート</strong>: 「PDF エクスポート」ボタンをクリック → PDFファイルがダウンロードされます</li>
        </ul>

        <p>エクスポートしたファイルは、Excel、Google スプレッドシート、または印刷して掲示板に掲示できます。</p>

        <h2 id="section4">4. ロール別機能</h2>

        <h3>4.1 ロールの種類</h3>

        <table>
            <thead>
                <tr>
                    <th>ロール</th>
                    <th>権限</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>super-admin</strong> <span class="badge badge-admin">最高権限</span></td>
                    <td>システム全体の管理権限。管理画面アクセス、全施設管理、全権限付与、ユーザー管理</td>
                </tr>
                <tr>
                    <td><strong>admin</strong> <span class="badge badge-admin">管理者</span></td>
                    <td>施設のシフト作成・編集・削除、スタッフ管理、メンバー招待（editor/viewer権限のみ付与可）</td>
                </tr>
                <tr>
                    <td><strong>editor</strong> <span class="badge badge-editor">編集者</span></td>
                    <td>施設のシフト作成・編集・閲覧、スタッフ情報の閲覧</td>
                </tr>
                <tr>
                    <td><strong>viewer</strong> <span class="badge badge-viewer">閲覧者</span></td>
                    <td>施設のシフト閲覧のみ</td>
                </tr>
            </tbody>
        </table>

        <h3>4.2 ロール別操作一覧</h3>

        <table>
            <thead>
                <tr>
                    <th>操作</th>
                    <th>super-admin</th>
                    <th>admin</th>
                    <th>editor</th>
                    <th>viewer</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>管理画面アクセス</td>
                    <td>✅</td>
                    <td>❌</td>
                    <td>❌</td>
                    <td>❌</td>
                </tr>
                <tr>
                    <td>スタッフ追加・編集・削除</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>❌</td>
                    <td>❌</td>
                </tr>
                <tr>
                    <td>シフト作成・編集</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>❌</td>
                </tr>
                <tr>
                    <td>シフト閲覧</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>✅</td>
                </tr>
                <tr>
                    <td>休暇申請登録・削除</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>❌</td>
                </tr>
                <tr>
                    <td>要件設定</td>
                    <td>✅</td>
                    <td>✅</td>
                    <td>❌</td>
                    <td>❌</td>
                </tr>
            </tbody>
        </table>

        <h2 id="section5">5. 管理画面（super-admin専用）</h2>

        <p><strong>アクセス</strong>: <a href="/admin" target="_blank">https://ai-care-shift-scheduler.web.app/admin</a></p>

        <h3>5.1 ダッシュボード</h3>
        <p>管理画面のトップページでは、以下の統計情報を確認できます：</p>
        <ul>
            <li>総施設数</li>
            <li>総ユーザー数</li>
            <li>総スタッフ数</li>
            <li>総シフト数</li>
        </ul>

        <h3>5.2 施設管理</h3>
        <ul>
            <li><strong>施設一覧</strong>: 左メニューから「施設管理」をクリック</li>
            <li><strong>新規施設作成</strong>: 「新規施設作成」ボタンをクリック → 施設名を入力 → 「作成」</li>
            <li><strong>施設詳細</strong>: 施設名をクリック → メンバー一覧、統計情報を確認</li>
        </ul>

        <h3>5.3 ユーザー管理</h3>
        <ul>
            <li><strong>ユーザー一覧</strong>: 左メニューから「ユーザー管理」をクリック</li>
            <li><strong>権限付与</strong>: ユーザー詳細ページで「権限付与」ボタン → 施設とロールを選択 → 「付与」</li>
            <li><strong>権限剥奪</strong>: ユーザー詳細ページで「権限剥奪」ボタン → 施設を選択 → 「剥奪」</li>
        </ul>

        <h3>5.4 監査ログ</h3>
        <ul>
            <li><strong>監査ログ一覧</strong>: 左メニューから「監査ログ」をクリック</li>
            <li><strong>フィルタリング</strong>: 日時範囲、ユーザーID、操作種別、対象リソースでフィルター</li>
            <li><strong>エクスポート</strong>: 「CSV エクスポート」または「JSON エクスポート」ボタンをクリック</li>
        </ul>

        <h3>5.5 セキュリティアラート</h3>
        <ul>
            <li><strong>アラート一覧</strong>: 左メニューから「セキュリティアラート」をクリック</li>
            <li><strong>ステータス更新</strong>: アラート詳細ページで「ステータス更新」ボタン → 新しいステータスを選択</li>
            <li><strong>手動検知</strong>: 「手動検知実行」ボタンをクリック</li>
        </ul>

        <h2 id="section6">6. よくある質問</h2>

        <h3>Q1. パスワードを忘れました</h3>
        <p><strong>A</strong>: このシステムはGoogle OAuth認証を使用しているため、パスワード管理は不要です。Googleアカウントでログインしてください。</p>

        <h3>Q2. ログインできません</h3>
        <p><strong>A</strong>: 以下を確認してください：</p>
        <ul>
            <li>Googleアカウントでログインしていますか？</li>
            <li>アクセス権限を付与されていますか？（2人目以降のユーザーの場合）</li>
            <li>インターネット接続は正常ですか？</li>
            <li>ブラウザのキャッシュをクリアしてみてください</li>
        </ul>

        <h3>Q3. シフトが生成されません</h3>
        <p><strong>A</strong>: 以下を確認してください：</p>
        <ul>
            <li>スタッフ情報が登録されていますか？</li>
            <li>シフト要件が設定されていますか？</li>
            <li>インターネット接続は正常ですか？</li>
            <li>エラーメッセージの内容を確認してください</li>
        </ul>

        <h3>Q4. スタッフを削除してしまいました</h3>
        <p><strong>A</strong>: 削除したスタッフは復元できません。再度登録してください。重要なデータは削除前に必ずバックアップ（CSV エクスポート）を取ることをお勧めします。</p>

        <h3>Q5. シフトを間違えて確定してしまいました</h3>
        <p><strong>A</strong>: 確定後もシフトの編集は可能です。また、バージョン履歴から過去のバージョンに復元することもできます（紫色の時計アイコンボタン）。</p>

        <h2 id="section7">7. トラブルシューティング</h2>

        <h3>7.1 ログインに関する問題</h3>

        <h4>問題: 「Googleでログイン」ボタンをクリックしても反応しない</h4>
        <p><strong>解決策</strong>:</p>
        <ul>
            <li>ブラウザのポップアップブロックを解除してください</li>
            <li>ブラウザを再起動してください</li>
            <li>キャッシュとCookieをクリアしてください</li>
        </ul>

        <h4>問題: 「アクセス権限がありません」と表示される</h4>
        <p><strong>解決策</strong>:</p>
        <ul>
            <li>super-adminまたはadmin権限を持つユーザーに連絡してください</li>
            <li>権限付与を依頼してください</li>
            <li>権限付与後、一度ログアウトして再度ログインしてください</li>
        </ul>

        <h3>7.2 シフト生成に関する問題</h3>

        <h4>問題: 「AIがシフトを生成できませんでした」エラー</h4>
        <p><strong>解決策</strong>:</p>
        <ul>
            <li>スタッフ数が十分か確認してください（最低3名以上推奨）</li>
            <li>シフト要件が厳しすぎないか確認してください</li>
            <li>再度「シフト作成実行」ボタンをクリックしてください</li>
        </ul>

        <h3>7.3 データに関する問題</h3>

        <h4>問題: リロード後にデータが消えた</h4>
        <p><strong>解決策</strong>:</p>
        <ul>
            <li>ログイン状態を確認してください（セッションが切れている可能性）</li>
            <li>インターネット接続を確認してください</li>
            <li>Firestoreへの保存が完了していたか確認してください</li>
        </ul>

        <h3>7.4 管理画面に関する問題</h3>

        <h4>問題: 管理画面にアクセスできない（403エラー）</h4>
        <p><strong>解決策</strong>:</p>
        <ul>
            <li>super-admin権限を持っているか確認してください</li>
            <li>ログアウトして再度ログインしてください</li>
            <li>URLが正しいか確認してください（<code>/admin</code>）</li>
        </ul>

        <hr style="margin: 40px 0; border: none; border-top: 1px solid #ddd;">

        <h2>お問い合わせ</h2>
        <p><strong>Email</strong>: <a href="mailto:admin@fuku-no-tane.com">admin@fuku-no-tane.com</a></p>
        <p><strong>GitHub Issues</strong>: <a href="https://github.com/yasushi-honda/ai-care-shift-scheduler/issues" target="_blank">https://github.com/yasushi-honda/ai-care-shift-scheduler/issues</a></p>
        <p><strong>サポート時間</strong>: 平日 9:00 - 18:00（土日祝日を除く）</p>
    </div>

    <footer>
        <p><strong>本番環境</strong>: <a href="https://ai-care-shift-scheduler.web.app" target="_blank">https://ai-care-shift-scheduler.web.app</a></p>
        <p style="margin-top: 10px;">© 2025 AIシフト自動作成システム. All rights reserved.</p>
    </footer>
</body>
</html>
